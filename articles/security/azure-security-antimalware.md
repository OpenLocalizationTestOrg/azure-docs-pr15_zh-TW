<properties
   pageTitle="Microsoft 反惡意程式碼 Azure 雲端服務和虛擬機器 |Microsoft Azure"
   description="本文提供 Microsoft 反惡意程式碼的 Azure，包括支援的案例及設定啟用、 設定及部署 Azure 雲端服務與虛擬機器保護架構概觀。 我們會說明基本設定、 管理和監視功能可透過 Microsoft Azure 服務管理 API 的 PowerShell 指令碼、 Azure 入口網站和 Visual Studio 存取。"
   services="security"
   documentationCenter="na"
   authors="YuriDio"
   manager="swadhwa"
   editor=""/>

<tags
   ms.service="security"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="09/19/2016"
   ms.author="yurid"/>

#<a name="microsoft-antimalware-for-azure-cloud-services-and-virtual-machines"></a>Microsoft 反惡意程式碼 Azure 雲端服務和虛擬機器

雲端環境現代威脅橫向是非常動態，商務 IT 壓力雲端訂閱者，若要維持有效的保護，以符合規範與安全性需求。 Microsoft 反惡意程式碼 Azure 雲端服務和虛擬機器是免費的即時保護功能，可協助找出並移除病毒、 間諜軟體及其他惡意軟體，可設定已知惡意或有害軟體嘗試安裝本身或 Azure 系統上執行時的通知。

在 Microsoft 安全性 Essentials 為相同的反惡意程式碼平台上內建的解決方案\[MSE\]，Microsoft Forefront 端點保護與 Microsoft 系統管理中心端點保護、 Windows Intune，8.0 及更新版本的 Windows 版的 Windows Defender。 Microsoft 反惡意程式碼的 Azure 是單一代理程式的解決方案的應用程式與租用戶的環境中，設計不會出現人力互動背景中執行。 您可以部署保護根據您的應用程式工作負載，與 [基本安全依預設的需求或進階自訂設定，包括監控反惡意程式碼。

當您部署，並啟用您的應用程式的 Microsoft 反惡意程式碼的 Azure 時，核心的可用功能如下︰

- **即時保護**-監視器在雲端服務，然後在虛擬機器偵測並封鎖惡意程式碼執行的活動。
- 定期**排程掃描**-執行目標掃描偵測惡意程式碼，包括執行程式。
- **惡意程式碼補救**-自動會偵測到惡意程式碼，例如刪除或隔離惡意檔案及清除惡意登錄項目採取動作。
- **簽章更新**-會自動安裝最新的保護簽名 （病毒定義） 以確保保護功能是最新的預定的頻率。
- **反惡意程式碼引擎更新**– 就會自動更新 Microsoft 反惡意程式碼引擎。
- **反惡意程式碼的平台更新**– 就會自動更新 Microsoft 反惡意程式碼的平台。
- **作用中的保護**-偵測到的威脅和可疑的資源相關報告遙測中繼資料，以確保發展威脅環境，以及啟用即時同步的簽章傳送到 Microsoft 作用中保護系統 （地圖） 的快速回應的 Microsoft Azure。
- **範例報告**-提供和範例報表可協助改善服務，並啟用疑難排解 Microsoft 反惡意程式碼服務。
- **排除項目**-可讓應用程式和服務系統管理員設定特定的檔案，處理程序及磁碟機，若要排除保護與掃描的效能及/或其他原因。
- **反惡意程式碼事件集合**-記錄反惡意程式碼服務健康狀況可疑的活動，與作業系統的事件記錄檔中的修復作業，並收集其客戶的 Azure 儲存體帳戶。

> [AZURE.NOTE] Microsoft 反惡意程式碼也可以使用 Azure 資訊安全中心來部署。 如需詳細資訊，請閱讀[在 Azure 資訊安全中心安裝端點保護](../security-center/security-center-install-endpoint-protection.md)。 

##<a name="architecture"></a>架構

Microsoft 反惡意程式碼 Azure 雲端服務及虛擬機器解決方案包括 Microsoft 反惡意程式碼用戶端和服務，反惡意程式碼傳統部署模型、 反惡意程式碼 PowerShell cmdlet 和 Azure 診斷副檔名。 Microsoft 反惡意程式碼解決方案支援 Windows Server 2008 R2、 Windows Server 2012，以及 Windows Server 2012 R2 作業系統系列。 不支援在 Windows Server 2008 作業系統上。 這次請在 Windows Server Technical Preview 不受支援，而我們想要在未來支援。

在所有支援的 Azure 虛擬作業系統系列中的雲端服務的平台的已停用狀態的預設會安裝 Microsoft 反惡意程式碼用戶端和服務。 Microsoft 反惡意程式碼用戶端和服務中的虛擬機器平台的預設不會安裝，且可為透過 Azure 入口網站和安全性] 之下的 Visual Studio 虛擬機器設定選擇性功能。

何時使用主控 web 應用程式的基本服務、 Azure 網站有 Microsoft 反惡意程式碼上加以啟用。 這用來保護 Azure 網站基礎結構，並不會執行客戶內容上。 


###<a name="microsoft-antimalware-workflow"></a>Microsoft 反惡意程式碼工作流程

Azure 服務系統管理員可以啟用反惡意程式碼的 Azure 預設或自訂設定您的虛擬機器和雲端服務，使用下列選項︰

-   虛擬機器 – 中 Azure] 入口網站的 [**安全性**] 之下

-   虛擬機器 – 伺服器總管] 中使用 Visual Studio 虛擬機器設定

-   虛擬機器和雲端服務 – 使用反惡意程式碼[傳統部署模型](https://msdn.microsoft.com/library/azure/ee460799.aspx)

-   虛擬機器和雲端服務 – 使用反惡意程式碼 PowerShell cmdlet

Azure 入口網站或 PowerShell cmdlet 推播反惡意程式碼擴充套件檔案，給預定的固定位置 Azure 系統。 Azure 來賓代理程式 （或布料的轉印圖樣代理程式） 啟動反惡意程式碼分機]，套用提供為輸入反惡意程式碼設定的設定。 此步驟可讓反惡意程式碼服務中，預設或自訂設定的設定。 如果不提供任何自訂設定，則反惡意程式碼服務已啟用的預設設定的設定。 請參閱 [*反惡意程式碼設定*] 區段中的[Microsoft 反惡意程式碼的 Azure 雲端服務與虛擬機器 – 程式碼範例](http://aka.ms/amazsamples "Microsoft Azure 雲端服務反惡意程式碼和 Vm 程式碼範例")如需詳細資訊。

後執行，Microsoft 反惡意程式碼用戶端從網際網路下載最新的保護引擎和簽章定義，並載入這些 Azure 系統上。 Microsoft 反惡意程式碼服務會將服務的相關事件，在 「 Microsoft 反惡意程式碼 」 事件來源] 下的系統 OS 事件記錄檔。 事件包括反惡意程式碼用戶端狀況、 保護及補救狀態、 新的和舊設定的設定、 引擎更新和簽章定義和其他人。

您可以啟用反惡意程式碼監控您的雲端服務或虛擬機器有撰寫 Azure 儲存體帳戶所產生的反惡意程式碼的事件記錄檔事件。 反惡意程式碼服務使用 Azure 診斷副檔名從 Azure 系統收集反惡意程式碼事件，到客戶的 Azure 儲存體帳戶中的資料表。

包含設定步驟和上述案例的支援選項的部署工作流程會記錄在這份文件[反惡意程式碼部署案例](#_Antimalware_Deployment_Scenarios)一節。

![Azure 中的 Microsoft 反惡意程式碼](./media/azure-security-antimalware/sec-azantimal-fig1.PNG)

> [AZURE.NOTE] 部署虛擬機器縮放比例設定 Microsoft 反惡意副檔名，您可以不過使用 Powershell/Api 和 Azure 資源管理員範本。  已執行的虛擬機器上安裝副檔名，您可以使用位於範例 python 指令碼*vmssextn.py* [以下](https://github.com/gbowerman/vmsstools)。 這個指令碼會在現有的副檔名組態取得上縮放比例設定，並加入現有的副檔名 VM 比例集的清單。

###<a name="default-and-custom-antimalware-configuration"></a>預設與自訂反惡意程式碼設定

預設設定的設定會套用至 Azure 雲端服務的虛擬機器啟用反惡意程式碼，當您不提供自訂設定的設定。 已預先最佳化執行 Azure 環境中的預設設定的設定。 （選擇性） 您可以自訂視需要為您的 Azure 應用程式或服務部署這些預設設定的設定，並將其套用其他部署案例。

> [AZURE.NOTE] 根據預設，Microsoft 反惡意程式碼的使用者介面上 Azure 資源管理員已停用，不支援[cleanuppolicy.xml](https://blogs.msdn.microsoft.com/azuresecurity/2016/02/24/update-on-microsoft-antimalware-and-azure-resource-manager-arm-vms/)略過此錯誤訊息的檔案。 如需如何建立自訂原則的資訊，請閱讀[在 Azure 資源管理員 Vm 文章部署啟用 Microsoft 反惡意程式碼使用者介面](https://blogs.msdn.microsoft.com/azuresecurity/2016/03/09/enabling-microsoft-antimalware-user-interface-post-deployment/)。 

下表摘要列出適用於反惡意程式碼服務設定的設定。 預設設定的設定標示標示為 「 預設 」 下的欄]。

![資料表 1](./media/azure-security-antimalware/sec-azantimal-tb18.PNG)

##<a name="antimalware-deployment-scenarios"></a>反惡意程式碼部署案例

若要啟用和設定反惡意程式碼，包括監視 Azure 雲端服務與虛擬機器案例討論此區段中。

###<a name="virtual-machines---enable-and-configure-antimalware"></a>虛擬機器-啟用和設定反惡意程式碼

**使用 Azure 入口網站的部署**

若要啟用反惡意程式碼服務，請副檔名刀上按一下 [**新增**、 選取新的資源刀**Microsoft 反惡意程式碼**，按一下 [**建立**]，請在 Microsoft 反惡意程式碼刀。 按一下 [**建立**]，請輸入任何的設定值，以啟用反惡意程式碼的預設設定，不，或輸入設定圖 2，如下所示的虛擬機器反惡意程式碼設定的設定。 請參閱新增副檔名刀上每個組態設定，請參閱支援的設定值所提供的**工具提示**。

![虛擬機器設定 Microsoft 反惡意程式碼的設定](./media/azure-security-antimalware/sec-azantimal-fig2.PNG)

**使用 [Azure 傳統入口網站的部署**

若要啟用並設定 Microsoft 反惡意程式碼的 Azure 虛擬機器時佈建虛擬機器中使用 Azure 入口網站，請遵循下列步驟︰

1.登入在<https://portal.azure.com> Azure 入口網站

2.若要建立新的虛擬機器中，按一下 [**新增**，**計算**、**虛擬****機器**，**從圖庫**（執行不使用快速建立），如下所示︰

![新的虛擬機器](./media/azure-security-antimalware/sec-azantimal-fig3.PNG)


3.選取**Microsoft Windows Server**上的圖像**選擇圖像**頁面。

4.按一下右箭號，再輸入虛擬機器設定。

5.檢查**Microsoft 反惡意程式碼**] 核取方塊**安全性**] 之下的虛擬機器設定] 頁面上。

6.按一下 [送出] 按鈕，以啟用及設定 Microsoft 反惡意程式碼的 Azure 虛擬機器的預設設定的設定]。

![虛擬機器設定](./media/azure-security-antimalware/sec-azantimal-fig4.PNG)

**使用 Visual Studio 虛擬機器設定的部署**

若要啟用並設定 Microsoft 反惡意程式碼服務使用 Visual Studio:

1.連線到 Microsoft Azure Visual Studio 中。

2.**虛擬機器**中節點**伺服器總管]**中選擇您的虛擬機器

![在 Visual Studio 中的虛擬機器設定](./media/azure-security-antimalware/sec-azantimal-fig5.PNG)

3.以滑鼠右鍵按一下 [檢視虛擬機器的 [設定] 頁面的 [**設定**

4.在**安裝副檔名]**下的下拉式清單選取**Microsoft 反惡意程式碼**延伸，然後按一下 [**新增**]，以設定與預設反惡意程式碼設定]。

![已安裝的副檔名](./media/azure-security-antimalware/sec-azantimal-fig6.PNG)

5.若要自訂預設的反惡意程式碼設定，請選取 （反白顯示） 的反惡意程式碼副檔名已安裝的副檔名] 清單中，按一下 [**設定**]。

6.取代預設的反惡意程式碼設定您的自訂設定支援 JSON 格式**公開金鑰設定**文字方塊中，然後按一下 [確定]。

7.按一下 [**更新**] 按鈕，若要將您的虛擬機器推設定更新。

![虛擬機器設定副檔名](./media/azure-security-antimalware/sec-azantimal-fig7.PNG)

**附註︰**反惡意程式碼的 Visual Studio 虛擬機器設定支援 JSON 格式設定。 反惡意程式碼 JSON 設定設定範本會包含在 Microsoft Azure 雲端服務反惡意程式碼，[而虛擬機器中的程式碼範例](http://aka.ms/amazsamples "Microsoft Azure 雲端服務反惡意程式碼和虛擬機器中的程式碼範例")，顯示支援反惡意程式碼設定的設定。

**部署使用 PowerShell cmdlet**

Azure 應用程式或服務可以啟用並設定 Microsoft 反惡意程式碼的 Azure 虛擬機器使用 PowerShell cmdlet。

若要啟用並設定 Microsoft 反惡意程式碼使用反惡意程式碼 PowerShell cmdlet:

1. 設定 PowerShell 環境-參照<https://github.com/Azure/azure-powershell>的文件

2. 使用設定 AzureVMMicrosoftAntimalwareExtension 反惡意程式碼 cmdlet 來啟用和設定 Microsoft 反惡意程式碼虛擬機器的如在<http://msdn.microsoft.com/library/azure/dn771718.aspx>

**附註︰**反惡意程式碼的 Azure 虛擬機器設定支援 JSON 格式設定。 反惡意程式碼 JSON 設定設定範本會包含在 Microsoft Azure 雲端服務反惡意程式碼，[而虛擬機器中的程式碼範例](http://aka.ms/amazsamples "Microsoft Azure 雲端服務反惡意程式碼和虛擬機器中的程式碼範例")，顯示支援反惡意程式碼設定的設定。

###<a name="enable-and-configure-antimalware-using-powershell-cmdlets"></a>啟用和設定反惡意程式碼使用 PowerShell cmdlet

Azure 應用程式或服務可以啟用，並針對 Azure 雲端服務使用 PowerShell cmdlet 設定 Microsoft 反惡意程式碼。 請注意，Microsoft 反惡意程式碼安裝在雲端服務平台停用狀態需要採取動作將它啟用 Azure 應用程式。

若要啟用並設定 Microsoft 反惡意程式碼使用 PowerShell cmdlet:

1.  設定 PowerShell 環境-參照<https://github.com/Azure/azure-sdk-tools#get-started>的文件

2.  使用設定 AzureServiceAntimalwareExtension 反惡意程式碼 cmdlet 來啟用和設定 Microsoft 反惡意程式碼雲端服務，如在<http://msdn.microsoft.com/library/azure/dn771718.aspx>

反惡意程式碼的 XML 組態設定範本會包含在 Microsoft Azure 雲端服務反惡意程式碼，[而虛擬機器中的程式碼範例](http://aka.ms/amazsamples "Microsoft Azure 雲端服務反惡意程式碼和虛擬機器中的程式碼範例")，顯示支援反惡意程式碼設定的設定。

###<a name="cloud-services-and-virtual-machines---configuration-using-powershell-cmdlets"></a>雲端服務和虛擬機器-設定使用 PowerShell cmdlet

Azure 應用程式或服務可擷取雲端服務和使用 PowerShell cmdlet 的虛擬機器的 Microsoft 反惡意程式碼設定。

若要擷取 Microsoft 反惡意程式碼設定使用 PowerShell cmdlet:

1.  設定 PowerShell 環境-參照<https://github.com/Azure/azure-sdk-tools#get-started>的文件

2.  **虛擬機器中**︰ 使用取得 AzureVMMicrosoftAntimalwareExtension 反惡意程式碼 cmdlet，以取得反惡意程式碼設定為在<http://msdn.microsoft.com/library/azure/dn771719.aspx>記錄

3.  **在雲端服務的**︰ 使用取得 AzureServiceAntimalwareConfig 反惡意程式碼 cmdlet，以取得反惡意程式碼設定為在<http://msdn.microsoft.com/library/azure/dn771722.aspx>記錄

###<a name="remove-antimalware-configuration-using-powershell-cmdlets"></a>移除反惡意程式碼設定使用 PowerShell cmdlet

Azure 應用程式或服務可移除反惡意程式碼設定，以及任何相關聯的反惡意程式碼監視設定相關 Azure 反惡意程式碼和診斷服務延伸雲端服務或虛擬機器相關聯。

若要移除 Microsoft 反惡意程式碼使用 PowerShell cmdlet:

1.  設定 PowerShell 環境-參照<https://github.com/Azure/azure-sdk-tools#get-started>的文件

2.  **虛擬機器中**︰ 使用移除 AzureVMMicrosoftAntimalwareExtension 反惡意程式碼 cmdlet，如在<http://msdn.microsoft.com/library/azure/dn771720.aspx>

3.  **雲端服務︰**使用記錄在<http://msdn.microsoft.com/library/azure/dn771717.aspx>移除 AzureServiceAntimalwareExtension 反惡意程式碼 cmdlet

虛擬機器中**啟用**反惡意程式碼事件集合使用 Azure 預覽入口網站︰

1.  按一下任何部分中的虛擬機器刀監控透鏡

2.  按一下 [公制刀上的 [診斷] 命令

3.  選取 [開啟]**狀態**，並檢查 Windows 事件系統的選項 
4.  . 您可以選擇所有其他清單選項中，取消核取或使其每次您的應用程式服務需要啟用保持。

4.  反惡意程式碼事件類別 」 的錯誤 」，「 警告 」、 「 資訊 」 等，會擷取您 Azure 儲存體帳戶。

從 Windows 系統記錄收集反惡意程式碼事件 Azure 儲存體帳戶。 您可以設定您選取適當的儲存帳戶收集反惡意程式碼事件的虛擬機器儲存帳戶。

![指標和診斷](./media/azure-security-antimalware/sec-azantimal-fig8.PNG)

> [AZURE.NOTE] 如需有關如何診斷記錄的 Azure 反惡意程式碼，請閱讀[啟用診斷記錄的 Azure 反惡意程式碼](https://blogs.msdn.microsoft.com/azuresecurity/2016/04/19/enabling-diagnostics-logging-for-azure-antimalware/)。

###<a name="enable-and-configure-antimalware-monitoring-using-powershell-cmdlets"></a>啟用和設定反惡意程式碼監視使用 powerShell cmdlet

您可以啟用 Microsoft 反惡意程式碼事件的雲端服務的反惡意程式碼 PowerShell cmdlet 透過使用診斷 Azure 虛擬機器中的集合。 要擷取的事件系統事件記錄檔來源 「 Microsoft 反惡意程式碼 」 Azure 儲存體帳戶，可以設定 Azure 診斷副檔名。 反惡意程式碼事件類別 」 的錯誤 」，「 警告 」、 「 資訊 」 等，會擷取您 Azure 儲存體帳戶。

若要啟用 Azure 儲存體帳戶使用 PowerShell cmdlet 的反惡意程式碼事件集合︰

1.  設定 PowerShell 環境- <https://github.com/Azure/azure-sdk-tools#get-started>參照

2.  **的虛擬機器中**使用監控開啟為在<http://msdn.microsoft.com/library/azure/dn771716.aspx>記錄] 選項設定 AzureVMMicrosoftAntimalwareExtension 反惡意程式碼 cmdlet

3.  **在雲端服務的**使用監控開啟為在<http://msdn.microsoft.com/library/azure/dn771718.aspx>記錄] 選項設定 AzureServiceAntimalwareExtension 反惡意程式碼 cmdlet

您可以查看您已設定要啟用反惡意程式碼監視 Azure 儲存體帳戶中的 WADWindowsEventLogsTable 資料表，來檢視反惡意程式碼的原始事件。 這會有幫助以驗證您使用反惡意程式碼事件集合，包括取得深入了解反惡意程式碼服務的健康狀況。 如需詳細資訊，包括如何從您儲存的帳戶，擷取反惡意程式碼事件的程式碼範例請參閱[Microsoft Azure 雲端服務反惡意程式碼和虛擬機器中的程式碼範例](http://aka.ms/amazsamples "Microsoft Azure 雲端服務反惡意程式碼和虛擬機器中的程式碼範例")。
