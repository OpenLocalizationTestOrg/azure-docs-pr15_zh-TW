<properties
    pageTitle="Azure 進階版儲存空間︰ 設計的效能 |Microsoft Azure"
    description="設計高效能應用程式使用 Azure 進階版儲存空間。 進階版儲存提供高效能、 低延遲磁碟支援 O-大量負載執行 Azure 虛擬機器上的商務連絡人。"
    services="storage"
    documentationCenter="na"
    authors="aungoo-msft"
    manager="tadb"
    editor="tysonn" />

<tags
    ms.service="storage"
    ms.workload="storage"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/18/2016"
    ms.author="aungoo"/>

# <a name="azure-premium-storage-design-for-high-performance"></a>高效能 azure 進階版儲存空間︰ 設計

## <a name="overview"></a>概觀  
本文提供建置高效能應用程式使用 Azure 進階版儲存空間的方針。 您可以使用效能最佳作法適用於應用程式所使用的技術與合併文件中所提供的指示。 若要說明的指導方針，我們使用 SQL Server 執行進階版的儲存量整個這份文件的範例。

我們解決能在本文中的儲存空間圖層的情況下，您必須最佳化應用程式層級。 例如，如果您是 SharePoint 伺服器陣列上 Azure 進階版儲存空間，您可以使用的 SQL Server 範例從這份文件最佳化的資料庫伺服器。 此外，最佳化 SharePoint 伺服器陣列的網頁伺服器及應用程式伺服器以取得最大的效能。

本文可協助追蹤 Azure 進階版的儲存空間，在應用程式效能最佳化的常見問題的解答

-   如何測量您的應用程式的效能？  
-   為什麼您沒有看到預期的高效能？  
-   哪些因素會影響應用程式效能上進階版儲存空間？  
-   這些因素如何影響效能的進階版存放區上的應用程式？  
-   您可以在如何最佳化用於 IOPS 頻寬與延遲？  

我們提供這些指導方針專為進階版儲存因為進階版儲存上執行的工作負載高度敏感的效能。 我們提供範例適當的位置。 您也可以套用這些指導方針的一些標準的儲存空間的磁碟 IaaS Vm 上執行應用程式。

您開始時，如果您是進階版儲存空間的新之前，先閱讀[進階版儲存空間︰ Azure 虛擬機器負載高效能儲存空間](storage-premium-storage.md)文章和[Azure 進階版儲存延展性和效能目標](storage-scalability-targets.md#premium-storage-accounts)。

## <a name="application-performance-indicators"></a>應用程式效能指標  
我們評估應用程式正在執行也或不使用指標等的效能是否速度應用程式正在處理的使用者要求，每個要求正在處理的應用程式的資料量、 多少要求是在特定一段時間，多久使用者已提交要求之後獲得回應等候中應用程式的處理。 這些效能指標的術語為，IOPS、 處理量或頻寬與延遲。

在此區段中，我們將討論一般效能指標進階版儲存的內容中。 在下列區段中，收集應用程式的需求，您將學習如何測量應用程式的這些效能指標。 更新版本中最佳化應用程式的效能，您將瞭解會影響這些效能指標與建議最佳化這些因素。

## <a name="iops"></a>IOPS  
IOPS 是一個數字的應用程式傳送到存放磁碟一秒內的要求。 輸入輸出作業無法讀取或撰寫、 連續或隨機。 OLTP 應用程式，例如線上零售網站需要立即處理許多使用者同時的要求。 使用者要求會插入和更新大量資料庫交易，應用程式必須快速處理。 因此，OLTP 應用程式需要更高的 IOPS。 這類應用程式處理數百萬種小型及隨機 IO 要求。 如果您有這類應用程式，您必須設計最佳化以用於 IOPS 的應用程式基礎結構。 在 [更新] 區段，*最佳化應用程式的效能*，我們討論所有取得高 IOPS 時，您必須考慮的因素詳細資料。

當您附加進階版儲存空間的磁碟至高縮放比例 VM Azure 提供您依照磁碟規格保證 IOPS 的數字。 例如，P30 磁碟佈建份 5000 IOPS。 每個高小數位數的虛擬記憶體大小也是它可以之前的特定 IOPS 限制。 例如，標準 GS5 VM 有 80,000 IOPS 限制。

## <a name="throughput"></a>處理量  
處理量或頻寬是您的應用程式中指定的間隔傳送到存放磁碟的資料量。 如果您的應用程式正在執行大型 IO 單位大小的輸入輸出作業，需要高處理量。 資料倉庫的應用程式會發出掃描大量的一次存取資料的大型部分，並經常執行 [大量作業。 換句話說，這類應用程式要求較高的處理量。 如果您有這類應用程式，您必須設計其基礎結構，以最佳化以用於處理量。 在下一步] 區段中，我們討論的詳細資料來達到這個目的，您必須微調的因素。

當您附加進階版儲存空間的磁碟至高的縮放比例 VM，依照該磁碟規格 Azure 條款處理量。 例如，P30 磁碟佈建新 200 MB 的每個第二個磁碟處理量。 它可以之前的特定傳送量限制也有每個高小數位數的虛擬記憶體大小。 例如，標準 GS5 VM 有秒 2000 MB 的最大處理量。

有處理量與下列公式中所示的 IOPS 之間的關聯。

![](media/storage-premium-storage-performance/image1.png)

因此，請務必來判斷您的應用程式需要的最佳輸出量和 IOPS 值。 當您嘗試最佳化之一，其他也會受到影響。 在稍後的章節，*最佳化應用程式的效能*，我們會討論更多詳細資料的相關最佳化 IOPS 與處理。

## <a name="latency"></a>延遲  
延遲是接收單一要求，將其傳送給儲存空間的磁碟傳送回覆給用戶端應用程式的時間。 這是效能的應用程式，除了 IOPS 與處理量值。 進階版儲存空間的延遲是磁碟的擷取要求的資訊和通訊，回到您的應用程式所需的時間。 進階版儲存提供一致的低延遲。 如果您啟用唯讀主機進階版儲存空間的磁碟上的快取，您可以取得更低的讀取的延遲。 我們將討論磁碟快取的更新] 區段中的更多詳細資料上*最佳化應用程式的效能*。

當您要最佳化您的應用程式，以取得更高的 IOPS，處理量時，它會影響您的應用程式的延遲。 之後微調] 應用程式的效能，一定會評估的應用程式，以避免非預期的高延遲行為發生的延遲。

## <a name="gather-application-performance-requirements"></a>收集效能的應用程式需求  
設計高效能 Azure 進階版儲存體上執行的應用程式的第一個步驟是，若要瞭解您的應用程式的效能需求。 收集效能需求之後，您可以針對應用程式，以獲得最佳效能。

前一節中，我們會說明常見效能指標 IOPS 處理量與延遲。 您必須找出哪些這些效能指標是您的應用程式，進行所要的使用者體驗的關鍵。 例如，高 IOPS 最重要的資訊中第二個處理數百萬異動 OLTP 應用程式。 而高處理量相當重要 Data Warehouse 應用程式中的第二個處理大量的資料。 太低延遲相當重要即時應用程式，例如即時串流網站的視訊。

接下來，測量最大效能應用程式的需求整個存留期間。 為開始使用] 下方的範例檢查清單。 在標準的最大效能需求、 最大使用量和離峰時間工作負載期間記錄。 藉由識別的所有工作負載層級的需求，您可以判斷您的應用程式的整體效能需求。 例如，電子商務網站的標準工作負載會它是在一年中的大部分天內的交易。 最大使用量工作負載的網站會卻佳節或特殊的銷售事件期間的交易。 最大使用量工作量通常是經驗豐富有限的時間，但可以要求您的應用程式，若要縮放的正常作業的兩個以上的時間。 找出 50 個百分位數、 90 的百分位數和 99 的百分位數的需求。 這可協助篩選出效能需求的任何範數，您可以將精力專注最佳化正確的值。

**應用程式效能需求檢查清單**

| **效能需求** | **50 個百分位數** | **90 的百分位數** | **99 百分位數** |
|---|---|---|---|
| 最大值。 每秒交易 | | | |
| %讀取操作            | | | |
| %寫入作業           | | | |
| %隨機作業          | | | |
| %循序進行的作業      | | | |
| IO 要求大小              | | | |
| 平均處理量           | | | |
| 最大值。 處理量              | | | |
| 最小值。 延遲                 | | | |
| 平均延遲              | | | |
| 最大值。 CPU                     | | | |
| 平均 CPU                  | | | |
| 最大值。 記憶體                  | | | |
| 平均的記憶體               | | | |
| 佇列深度                  | | | |

>**重要事項︰**  
>您應該考慮縮放根據您的應用程式的預期未來的成長這些數字。 這會是規劃等比級數提前，建議您先，因為它可能會比較難以若要變更的基礎結構，以改善效能更新版本。

如果您有現有的應用程式，並想要移至 [進階版儲存空間，請先建立現有的應用程式上方的檢查清單。 然後建立的進階版存放區上的應用程式原型設計依據*最佳化應用程式的效能*這份文件的更新區段中所述的指導方針的應用程式。 下一節說明您可以用來收集效能度量單位的工具。

建立檢查清單，讓您現有的應用程式原型類似。 您可以使用 Benchmarking 工具模擬負載並測量原型應用程式的效能。 若要深入瞭解[Benchmarking](#benchmarking)上，請參閱] 區段。 執行，您可以判斷進階版儲存可以符合或超越應用程式的效能需求。 然後您可以執行相同的指導方針生產應用程式。

### <a name="counters-to-measure-application-performance-requirements"></a>測量應用程式的效能需求計數器  
測量您的應用程式的需求來效能的最佳方式就是伺服器的使用效能監視工具提供的作業系統。 您可以使用 Windows 版的效能和 iostat Linux 的。 這些工具擷取計數器對應至每個以上的一節所述的量值。 當您的應用程式正在執行，其標準、 最大使用量與離峰時間工作負載時，您必須擷取這些計數器的值。

監視效能計數器可供處理器，記憶體，每個邏輯磁碟和伺服器的實體磁碟。 當您與 VM 使用進階版儲存空間的磁碟時，實體磁碟計數器是每個進階版儲存磁碟，且邏輯磁碟計數器進階版儲存空間的磁碟上建立的每一個磁碟。 您必須擷取主控您的應用程式工作負載的磁碟的值。 邏輯和實體磁碟之間一對一對應時，您可以參考實體磁碟計數器;否則，請指向邏輯磁碟計數器。 在 Linux，iostat] 命令會產生 CPU 和磁碟的使用情況報表。 磁碟使用情況報表提供每個實體裝置或磁碟分割的統計資料。 如果您有不同的磁碟上的資料庫伺服器的資料和記錄，收集這兩個磁碟的資料。 下表說明計數器磁碟、 處理器和記憶體︰

| [計數器 | 描述 | 效能 | Iostat |
|---|---|---|---|
| **IOPS 或秒交易** | I/O 要求發給儲存磁碟秒數。 | 磁碟讀取數秒 <br> 磁碟寫入/秒 | tps <br> r/s <br> w/s |
| **磁碟讀取與寫入** | %的讀取和寫入磁碟上執行的作業。 | %磁碟讀取時間 <br> %磁碟寫入時間 | r/s <br> w/s |
| **處理量** | 讀取或寫入每秒磁碟的資料量。 | 閱讀秒位元組磁碟 <br> 磁碟寫入每秒位元組 | kB_read/s <br> kB_wrtn/s |
| **延遲** | 若要完成的磁碟 IO 要求的總時間。 | 平均磁碟 sec/已讀取 <br> 平均磁碟 sec 寫 | 等 <br> svctm |
| **IO 大小** | I/O 大小要求的儲存空間的磁碟問題。 | 平均磁碟位元組/已讀取 <br> 平均磁碟位元組寫 | avgrq sz |
| **佇列深度** | 數字的 I/O 要求等候表單的讀取或寫入儲存空間的磁碟。 | 目前磁碟佇列長度 | avgqu sz |
| **最大值。記憶體** | 若要順利執行應用程式需要的記憶體 | %認可位元組使用中 | 使用 vmstat |
| **最大值。CPU** | 量 CPU 才能順利執行應用程式 | %處理器時間 | 但是 % |

瞭解更多關於[iostat](http://linuxcommand.org/man_pages/iostat1.html)和[效能](https://msdn.microsoft.com/library/aa645516.aspx)。


## <a name="optimizing-application-performance"></a>最佳化應用程式的效能  
影響效能執行進階版存放區上的應用程式的主要因素是性質的 IO 要求虛擬記憶體大小、 磁碟大小，磁碟磁碟快取、 多執行緒處理和佇列深度數目。 您可以使用系統提供的參數來控制這些因素。 大部分的應用程式可能無法提供直接改變 IO 大小和佇列深度的選項。 例如，如果您使用 SQL Server，您無法選擇 IO 大小和佇列中深度。 SQL Server 選擇最佳 IO 大小和佇列中深度值以取得最大的效能。 請務必瞭解您的應用程式的效能，這兩種類型的因素的影響，好讓您可以提供適當的資源，以符合效能的需求。

在本節中，請參閱建立，以識別您需要多少最佳化您的應用程式的效能的應用程式需求檢查清單。 根據的您將能夠判斷哪些因素從此節您會需要調整。 為見證應用程式效能每個因素的影響，請在 [應用程式安裝上執行效能評估工具。 請參閱本文最後的步驟執行一般效能評估工具在視窗和 Linux Vm [Benchmarking](#Benchmarking)一節。

### <a name="optimizing-iops-throughput-and-latency-at-a-glance"></a>最佳化 IOPS 處理量與延遲概覽  
下表摘要列出所有效能因素和最佳化 IOPS 處理量與延遲的步驟。 [追蹤此摘要] 區段會說明各因素是更多深度。

| | **IOPS** | **處理量** | **延遲** |
|---|---|---|---|
| **範例案例** | 需要更高的交易每秒速率企業 OLTP 應用程式。                                                                                                                                 | 企業資料倉儲應用程式處理大量的資料。 | 附近即時的應用程式要求使用者要求，線上遊戲等立即回應。 |
| 效能的因素  | | | |
| **IO 大小** | 縮小 IO 大小會產生更高的 IOPS。                                                                                                                                                                           | 較大 IO 大小會產生更高的處理量。 | |
| **虛擬記憶體大小** | 使用提供 IOPS 大於您的應用程式需求虛擬記憶體大小。 請參閱 VM 大小和其 IOPS 限制。 | 使用處理量限制大於您的應用程式需求虛擬記憶體大小。 請參閱 VM 大小和其處理限制。 | 使用提供縮放限制大於您的應用程式需求虛擬記憶體大小。 請參閱 VM 大小和其的限制。 |
| **磁碟大小** | 使用提供 IOPS 大於您的應用程式需求磁碟大小。 請參閱磁碟大小和其 IOPS 限制。 | 使用磁碟傳送量限制大於您的應用程式的需求。 請參閱磁碟大小和其處理限制。 | 使用磁碟大小優惠縮放限制大於您的應用程式的需求。 請參閱磁碟大小和其的限制。 |
| **VM 與磁碟比例限制** | 選擇虛擬記憶體大小 IOPS 限制應大於總 IOPS 由附加進階版儲存空間的磁碟。 | 選擇虛擬記憶體大小處理量限制應大於由進階版儲存空間的磁碟附加的總處理量。 | 選擇虛擬記憶體大小的小數位數限制必須大於附加進階版存放磁碟的總比例限制。 |
| **磁碟快取** | 閱讀大量作業，以取得更高的讀取 IOPS 進階版儲存磁碟上啟用唯讀快取。 | | 準備好重的作業，以取得極低讀取延遲的進階版儲存磁碟上啟用唯讀快取。 |
| **具** | 使用多個磁碟，然後等量磁碟區以取得結合更高 IOPS 和處理量的限制。 請注意，每個 VM 合併的限制應高於附加進階版磁碟的合併的限制。 | |
| **等量大小** | 條紋小 OLTP 應用程式中看到的隨機小型 IO 圖樣。 例如，使用 SQL Server OLTP 應用程式等量大小為 64 KB。 | 連續 Data Warehouse 應用程式中看到的大型 IO 圖樣的較大等量大小。 SQL Server 資料倉庫應用程式，例如，使用 256 KB 等量大小。 | |
| **多執行緒處理** | 使用多執行緒推入時會連到較高的 IOPS 和處理量的進階版儲存空間的 [要求較高的數目。 例如，在 SQL Server 設定高 MAXDOP 值配置更多的 Cpu 到 SQL Server。 | |
| **佇列深度** | 較大的佇列深度會產生更高的 IOPS。 | 較大的佇列深度會產生更高的處理量。 | 較小的佇列深度產生較低的延遲時間。 |

## <a name="nature-of-io-requests"></a>IO 要求的性質  
IO 要求是會執行您的應用程式的輸入輸出作業的單位。 識別 IO 要求隨機或循序，性質的讀取或寫入小型或大，可協助您判斷您的應用程式的效能需求。 務必瞭解 IO 要求]，以正確的決策設計您的應用程式基礎結構時性質。

IO 大小是一種更重要的因素。 IO 大小會與輸入輸出作業要求應用程式所產生的大小。 IO 大小會影響效能，尤其是在 IOPS 和應用程式都能獲得的頻寬上。 下列公式會顯示 IOPS，之間的關聯性 IO 大小和頻寬/處理量。  
    ![](media/storage-premium-storage-performance/image1.png)

部分應用程式可讓您變更其 IO 大小，而有些應用程式沒有。 例如，SQL Server 決定最佳 IO 大小本身，並不提供使用者使用任何變更它的參數。 另一方面，Oracle 提供稱為參數[DB\_封鎖\_大小](https://docs.oracle.com/cd/B19306_01/server.102/b14211/iodesign.htm#i28815)使用您可以設定資料庫 I/O 要求大小。

如果您使用應用程式，而不允許您變更 IO 大小，使用本文中的指導方針，若要最佳化效能最適合您的應用程式的 KPI。 例如，

-   OLTP 應用程式會產生數百萬種小型及隨機 IO 要求。 若要處理這些類型的 IO 要求，您必須設計您的應用程式基礎結構，以取得更高的 IOPS。  
-   資料倉儲應用程式會產生大型與循序 IO 要求。 若要處理這些類型的 IO 要求，您必須設計您的應用程式基礎結構，以取得更高的頻寬或處理量。

如果您使用應用程式，可讓您變更 IO 大小，使用其他效能指導方針，除了 IO 大小的基本原則

-   若要取得更高的 IOPS 縮小 IO 大小。 例如，8 KB OLTP 應用程式。  
-   若要取得更高的頻寬/處理量的較大 IO 大小。 資料倉庫應用程式，例如 1024 KB。

以下是如何計算處理量/頻寬和 IOPS 應用程式的範例。 請考慮使用 P30 磁碟的應用程式。 最大可達到 IOPS 和處理量頻寬 P30 磁碟為 5000 IOPS 及 200 MB 秒分別。 現在，您的應用程式需要從 P30 磁碟，最大 IOPS，並使用較小的 IO 大小，例如 8 KB，您將能夠取得結果頻寬 40 MB 秒。 不過，如果您的應用程式需要最大從 P30 磁碟處理量/頻寬，而且您使用較大的 IO 大小，例如 1024 KB，產生 IOPS 會小於，200 IOPS。 因此，調整 IO 大小，使其符合這兩種應用程式的 IOPS 和處理量/頻寬需求。 下表摘要列出不同 IO 大小和其對應 IOPS 和處理量 P30 磁碟。

| **應用程式需求** | **I/O 大小** | **IOPS** | **處理量/頻寬** |
|-----------------------------|--------------|----------|--------------------------|
| 最大值 IOPS                    | 8 KB         | 5000    | 每秒 40 MB         |
| 最大值處理量              | 1024 KB      | 200      | 每秒 200 MB        |
| 最大值處理量 + 高 IOPS  | 64 KB        | 3,200    | 每秒 200 MB        |
| 最大值 IOPS + 高處理量  | 32 KB        | 5000    | 每秒 160 MB        |

若要取得 IOPS 與頻寬高於單一進階版儲存空間的磁碟的最大值，請使用多個進階版磁碟一起。 例如，條紋兩個 P30 磁碟秒取得 10000 IOPS 合併的 IOPS 或 400 MB 的合併處理能力。 下一節所述，您必須使用虛擬記憶體大小支援合併的磁碟 IOPS 和處理量。

>**附註︰**  
>增加 IOPS 或是其他也會增加處理量，請確定您執行不按產能或磁碟或 VM IOPS 限制增加其中之一。

為見證應用程式的效能 IO 大小的影響，您可以在 VM 和磁碟上執行效能評估工具。 建立多個測試就會執行，並使用的每次執行的不同 IO 大小，請參閱影響。 請參閱本文的更多詳細資料的結尾[Benchmarking](#Benchmarking)一節。

## <a name="high-scale-vm-sizes"></a>高的縮放比例 VM 大小  
當您開始設計應用程式時，第一個項目執行的是，選擇 VM 裝載您的應用程式。 高的縮放比例 VM 大小可執行應用程式要求較高的運算能力與本機磁碟 I/O 效能隨附進階版儲存空間。 這些 Vm 的本機磁碟，提供更快速的處理器，較高的記憶體-核心比例，Solid-State 磁碟機 (SSD)。 高的縮放比例 Vm 支援進階版儲存空間的範例是 DS、 DSv2 和 GS 數列 Vm。

高的縮放比例 Vm 可在不同的數 CPU 核心、 記憶體、 OS 和暫時磁碟大小的不同大小。 每個虛擬記憶體大小也是您可以附加到 VM 資料磁碟的最大數目。 因此，所選的虛擬記憶體大小會影響多少處理、 記憶體，而且儲存容量適用於您的應用程式。 也會影響計算並顯示儲存空間成本。 例如，以下是最大虛擬記憶體大小 DS 數列、 DSv2 數列和 GS 數列中的規格︰

| 虛擬記憶體大小 | CPU 核心 | 記憶體 | VM 磁碟大小 | 最大值。 資料磁碟 | 快取大小 | IOPS | 頻寬快取 IO 限制 |
|---|---|---|---|---|---|---|---|
| Standard_DS14 | 16 | 112 GB | OS = 1023 GB <br> 本機 SSD = 224 GB | 32 | 576 GB | 50000 IOPS <br> 每秒 512 MB | 4000 IOPS 和秒 33 MB |
| Standard_GS5 | 32 | 448 GB | OS = 1023 GB <br> 本機 SSD = 896 GB | 64 | 4224 GB | 80,000 IOPS <br> 每秒 2000 MB | 5000 IOPS 和秒 50 MB |

若要檢視所有可用的 Azure VM 大小的完整清單，請參閱[Windows VM 大小](../virtual-machines/virtual-machines-windows-sizes.md)或[Linux VM 大小](../virtual-machines/virtual-machines-linux-sizes.md)。 選擇 [虛擬記憶體大小，可以符合您所要的應用程式的效能需求不按比例縮放]。 此外，請選擇 VM 大小時，追蹤重要考量。


*縮放比例限制*  
每個 VM 和每個磁碟的最大 IOPS 限制而不同個別獨立。 請確定應用程式限制內的 VM，以及進階版磁碟附加的推動 IOPS。 否則，應用程式的效能，會遇到節流設定。

例如，假設應用程式需求 4000 IOPS 最大值。 若要達到此，您佈建 DS1 VM P30 磁碟。 P30 磁碟進行多達 5000 個 IOPS。 不過，DS1 VM 僅限於 3,200 IOPS。 因此，應用程式的效能會受到 3,200 IOPS VM 限制，也會有降級的效能。 若要避免這種情況下，選擇將會同時 VM 和磁碟大小符合應用程式的需求。

*操作的成本*  
在許多情況下，可能是作業的使用進階版儲存空間的整體成本低於使用標準的儲存空間。

例如，請考慮要求 16000 IOPS 應用程式。 若要達到此效能，您需要標準\_D14 Azure IaaS VM，以便讓 16000 使用 32 標準存放 1 TB 磁碟最大 IOPS。 每個 1 TB 標準的儲存空間的磁碟可達到 500 IOPS 最大值。 這個 VM，每個月的估計的成本會 $1,570。 每月 32 標準的儲存空間的磁碟的成本會 $1,638。 估計的每月總成本會 $3,208。

不過，如果您裝載相同的應用程式上進階版儲存空間，您需要較小的虛擬記憶體大小和較少進階版儲存空間的磁碟，有助於縮小的整體成本。 標準\_DS13 VM 符合 16000 IOPS 需求使用四個 P30 磁碟。 DS13 VM 有 25,600 最大 IOPS，而且每個 P30 磁碟有 5000 最大 IOPS。 整體來說，此設定可以獲得 20000 = 4 5000 x IOPS。 這個 VM，每個月的估計的成本會 $1,003。 每月的四個 P30 進階版儲存空間的磁碟成本會 $544.34。 估計的每月總成本會 $1,544。

下表說明這種情況的成本分解標準和進階版儲存空間。

| | **標準** | **進階版** |
|---|---|---|
| **成本 VM 每個月** | $1,570.58 (標準\_D14)   | $1,003.66 (標準\_DS13) |
| **每個月的成本的磁碟** | $ 1,638.40 （32 x 1 TB 磁碟） | $ 544.34 （4 x P30 磁碟） |
| **每個月的整體成本**  | $ 3,208.98 | $ 1,544.34 |

*Linux Distros*  

Azure 進階版的儲存空間，您存取效能 Vm 同一層的級執行 Windows 和 Linux。 我們支援 Linux distros 有許多種，而且您可以看到的完整清單[以下](../virtual-machines/virtual-machines-linux-endorsed-distros.md)。 請務必注意不同 distros 更適合不同類型的工作量。 您會看到不同層級的效能取決於您的工作量執行 distro。 測試您的應用程式 Linux distros，然後選擇最適合的項目]。


執行中時 Linux 與進階版儲存空間，檢查最新的更新，以確保高效能必要驅動程式的相關。

## <a name="premium-storage-disk-sizes"></a>進階版儲存空間的磁碟大小  
Azure 進階版儲存目前提供三種磁碟大小。 每個磁碟大小會有不同的比例限制 IOPS、 頻寬和儲存空間。 選擇 [向右進階版儲存空間的磁碟大小取決於應用程式的需求和最高的刻度虛擬記憶體大小]。 下表顯示三個磁碟大小和功能。

| **磁碟類型**       | **P10**           | **P20**           | **P30**           |
|---------------------|-------------------|-------------------|-------------------|
| 磁碟大小           | 128 鉤           | 512 鉤           | 1024 鉤 (1 TB)   |
| 每個磁碟 IOPS       | 500               | 2300              | 5000              |
| 每個磁碟處理量 | 每秒 100 MB | 每秒 150 MB | 每秒 200 MB |

多少所選的取決於磁碟大小的選擇。 您可以使用單一 P30 磁碟或多個 P10 磁碟，以符合您的應用程式的需求。 如果需要考慮的帳戶進行選擇時，下方所列的考量事項。

*縮放比例限制 （IOPS 和處理量）*  
IOPS 與處理的每個進階版磁碟大小限制為 VM 比例限制不同，不受影響。 請確定的總 IOPS 及處理量從磁碟是在所選的虛擬記憶體大小的小數位數限制範圍內。

例如，如果應用程式需求，最大 250 MB sec 處理量值，而您使用 DS4 VM 搭配單一 P30 磁碟。 DS4 VM 可以授權讓最 256 MB/sec 處理量。 不過，在單一 P30 磁碟有秒 200 MB 處理量限制。 因此，應用程式將會限制，因為磁碟限制 200 MB 秒。 若要解決此限制，提供多個資料磁碟的 vm。

>**附註︰**  
>由 [快取的讀取不會包含在磁碟 IOPS 和處理量，因此沒有因磁碟限制。 快取會有每 VM 其個別 IOPS 與處理限制。
>
>例如，一開始您讀取與寫入秒 60 MB 分別為和秒 40 MB。 一段時間，快取 warms，然後從快取服務的讀取。 然後，您也可以從磁碟取得更高寫入處理量。

*磁碟數目*  
決定您需要的評估應用程式的需求的磁碟數目。 每個虛擬記憶體大小也有的限制，可附加至 VM 的磁碟數目。 一般而言，這是按兩次核心的數量。 請確定您選擇的虛擬記憶體大小可支援所需的磁碟數目。

請記住，進階版儲存空間的磁碟有較高的效能功能比標準的儲存空間的磁碟。 因此，如果您要移轉應用程式從 Azure IaaS VM 使用進階版儲存空間的標準儲存空間，您可能需要較少的進階版磁碟達成相同或更高應用程式的效能。

## <a name="disk-caching"></a>磁碟快取  
高運用 Azure 進階版儲存的縮放比例 Vm 有稱為 BlobCache 的多層快取技術。 BlobCache 會使用快取的虛擬機器 RAM 與本機 SSD 的組合。 此快取適用於進階版儲存常設及 VM 本機磁碟。 根據預設，此快取設定以讀/寫 OS 磁碟及唯讀資料裝載於進階版儲存空間的磁碟。 與磁碟快取進階版儲存空間的磁碟上啟用，高的縮放比例 Vm 可達到太高層級的效能超過基礎磁碟的效能。

>[AZURE.WARNING] 變更 Azure 磁碟快取設定中斷的連結，然後重新附加目標磁碟。 如果這是作業系統磁碟，重新啟動 VM。 停止所有應用程式/服務可能會影響此中斷，才能變更磁碟快取設定。

若要進一步瞭解 BlobCache 的運作方式，請參閱內部[Azure 進階版儲存體](https://azure.microsoft.com/blog/azure-premium-storage-now-generally-available-2/)部落格文章。

請務必啟用正確的磁碟上的快取。 您是否應該啟用磁碟快取進階版磁碟上，或不會取決於的工作量模式的磁碟會處理。 下表顯示預設的作業系統與資料磁碟快取設定。

| **磁碟類型** | **預設的快取設定** |
|---|---|
| OS 磁碟 | ReadWrite |
| 資料磁碟 | 無 |

以下是資料磁碟的建議的磁碟快取設定

| **磁碟快取設定** | **何時使用此設定的建議** |
|---|---|
| 無 | 將主機快取設定為無唯] 與 [寫入高磁碟。 |
| 唯讀 | 唯讀及讀寫磁碟主機快取設定以唯讀模式。 |
| ReadWrite | 只有當應用程式正確處理寫入時所需的持續磁碟快取的資料，請為 ReadWrite 設定主機快取。 |

*唯讀*  
藉由設定進階版儲存資料的磁碟快取的唯讀，可以獲得低讀取延遲，並取得您的應用程式中的更高 IOPS 讀取和處理量。 這是因為兩個原因，

1.  讀取 VM 記憶體和本機 SSD 上快取中執行，從資料磁碟空間，位於 Azure blob 儲存體讀取比更快。  
2.  進階版儲存不會計算中快取，根據磁碟 IOPS 及處理量的讀取。 因此，您的應用程式是達到較高的總 IOPS 和處理量。

*ReadWrite*  
根據預設，OS 磁碟有啟用 ReadWrite 快取。 我們最近新增快取資料以及磁碟 ReadWrite 的支援。 如果您使用的 ReadWrite 快取，您必須有適當的方式，將資料從快取寫入常設磁碟。 例如，SQL Server 處理自己寫入常設儲存空間的磁碟快取的資料。 如果 VM 當機 ReadWrite 快取使用的應用程式，並不會處理保存所需的資料會造成資料遺失。

例如，您可以套用這些指導方針 SQL Server 執行進階版存放區上，執行下列動作，

1.  設定進階版裝載資料檔案的儲存空間磁碟上的 「 唯讀 」 快取。  
    。  快速讀取較低的快取由於從快取更快速擷取資料頁的 SQL Server 查詢時間比直接從資料磁碟。  
    b。  從快取服務讀取，表示有提供進階資料磁碟的其他處理量。 SQL Server 可以使用此根據擷取詳細資料頁面和其他作業，例如備份/還原的其他處理量批次載入，以及在重建索引。  
2.  設定 「 無 「 快取主機服務記錄檔的進階版儲存磁碟上。  
    。  記錄檔有主要寫入大量作業。 因此，他們沒有差別從唯讀快取。

## <a name="disk-striping"></a>具  
當 VM 附有數個進階版存放常設磁碟高等級時，磁碟可以是等量共同彙總其 IOPs、 頻寬，以及儲存容量。

在 Windows 上，您可以使用儲存空間量磁碟分成一組。 集區中，您必須設定每個磁碟的一欄。 否則，條紋大量的整體效能可低於預期，因為不平均分佈流量到磁碟。

重要事項︰ 使用伺服器管理員使用者介面，您可以設定的欄最 8 等量的大量的總數。 當附加 8 個以上的磁碟，使用 PowerShell 來建立音量。 使用 PowerShell，您可以設定欄數等於磁碟的數字。 例如，如果單一條紋集中; 沒有 16 磁碟*新增 VirtualDisk* PowerShell 指令程式的*NumberOfColumns*參數中指定 16 個資料行。


在 Linux，同時使用條紋磁碟 MDADM 公用程式。 如需詳細步驟 linux 等量磁碟上，請參閱[設定軟體襲擊 Linux](../virtual-machines/virtual-machines-linux-configure-raid.md)。


*等量大小*  
具中重要的設定是等量的大小。 等量大小或區塊大小是最小的應用程式可以解決上等量的大量資料區塊。 您設定等量大小取決於應用程式和其要求圖樣類型。 如果您選擇錯誤等量大小，可能會導致 IO 對齊錯誤，您的應用程式的效能降低潛在客戶。

例如，如果應用程式所產生的 IO 要求大於磁碟等量大小，儲存系統將它跨等量單位界限一個以上的磁碟上。 當存取該資料時，會有搜尋跨多個等量單位完成要求。 這種行為的累積效果可能會導致效能大幅降低。 相反地，如果 IO 要求大小小於等量大小，如果是隨機的 IO 要求可能會加總導致瓶頸及最後折損 IO 效能相同的磁碟上。


根據您的應用程式正在執行的工作負載的類型，選擇適當的等量大小。 隨機小型 IO 要求，使用較小的量。 而大型連續 IO 要求使用較大的量。 找出條紋大小建議應用程式的您會執行進階版的儲存量。 SQL Server，設定等量大小 OLTP 工作負載的 64 KB 和資料倉儲工作負載的 256 KB。 請參閱若要深入瞭解[效能的 SQL Server Azure Vm 上的最佳作法](../virtual-machines/virtual-machines-windows-sql-performance.md#disks-and-performance-considerations)。


>**附註︰**  
>您可以等量磁碟區一起 32 進階版儲存在 DS 系列 VM 及 64 進階版儲存磁碟上 GS 系列 VM 的最大值。

## <a name="multi-threading"></a>多執行緒處理  
Azure 設計進階版儲存為可大規模平行的平台。 因此，多執行緒應用程式已達到多較高的效能比單一階層式的應用程式。 多執行緒應用程式跨多執行緒分割任務設定，並利用 VM 和磁碟資源來最大值，藉此增加執行的效率。

例如，如果在單一核心 VM 使用兩個執行緒上執行應用程式，CPU 可以達成效率的兩個執行緒之間切換。 一個執行緒正在等候的磁碟 IO 完成，同時 CPU 可以切換到另一個執行緒中。 如此一來，兩個執行緒可以完成更多比單一執行緒。 如果 VM 有一個以上的核心，它進一步將會減少執行時間由於每個核心可以平行地執行工作。

您可能無法變更的現成的應用程式實作單一執行緒或多執行緒處理。 例如，SQL Server 是可以處理多 CPU 與多核心。 不過，SQL Server 會決定在哪些情況下，它會運用一或多個執行緒處理查詢。 可執行查詢並建立索引使用多執行緒處理。 查詢包含加入大型表格和排序資料傳回給使用者之前，SQL Server 可能會使用多個執行緒。 不過，使用者無法控制是否 SQL Server 執行查詢，使用單一執行緒或多個執行緒。

沒有設定的設定，您可以改變影響此多執行緒處理或平行處理應用程式。 例如，若 SQL Server 是最大的平行度設定。 處理稱為 MAXDOP，可讓您設定平行時，可以使用 SQL Server 的處理器數目上限這項設定。 您可以設定 MAXDOP 個別查詢或索引作業。 當您想要平衡系統效能的要徑應用程式的資源時，這是有幫助。

例如，假設您的應用程式使用 SQL Server 執行大型查詢並同時索引作業。 讓我們假設您想要更具效能比較大型查詢索引作業。 在這種情況下，您可以設定 MAXDOP 值高於查詢的 MAXDOP 值在索引作業。 如此一來，SQL Server 中有更多的數字的處理器，就可以運用索引作業，可以讓專屬於大型查詢的處理器數目的比較。 請記住，您不能控制的 SQL Server 會使用每個作業的執行緒數目。 您可以控制的專用的處理器數目上限多執行緒處理。

進一步瞭解在 SQL Server 中[平行度](https://technet.microsoft.com/library/ms188611.aspx)。 瞭解多執行緒處理您的應用程式和他們的設定，若要最佳化效能影響這些設定。

## <a name="queue-depth"></a>佇列深度  
佇列深度佇列長度或佇列大小位於系統等候 IO 要求的數目。 深度佇列中的值會決定您的應用程式可以對齊，儲存空間的磁碟處理多少 IO 作業。 它會影響此文章 viz.IOPS 處理量與延遲所述的所有三個應用程式效能指標。

佇列深度與多執行緒處理密切相關。 佇列深度值會指出多少多執行緒處理可透過應用程式。 如果佇列深度很大，應用程式可更多作業同時執行，也就是說，更多執行緒處理。 如果佇列深度小，即使多執行緒應用程式，它不會列於同時執行不足，無法要求。

一般而言，shelf 關閉應用程式不允許您變更佇列深度，因為如果設定不正確，就會執行比好的多個傷害。 應用程式將佇列深度得到最佳效能的正確的值。 不過，務必瞭解此概念，好讓您可以使用您的應用程式疑難排解效能問題。 您也可以在系統執行效能評估工具觀察佇列深度的效果。

部分應用程式提供設定以影響佇列深度。 例如，MAXDOP （平行度） 中的 [設定前一節所述的 SQL Server。 MAXDOP 是會影響佇列深度的方式與多執行緒處理，但不會直接變更的 SQL Server 佇列深度值。

*高佇列深度*  
高佇列深度排列磁碟上的其他操作。 磁碟知道提前其佇列中的下一個要求。 因此，磁碟可以排程提前作業，並處理這些最佳的順序。 應用程式傳送到磁碟更多的要求，因為磁碟可以處理更多平行 IOs。 最後，應用程式能夠達成較高的 IOPS。 由於應用程式正在處理更多的要求，也會增加總的處理量的應用程式。

一般而言，應用程式，可以獲得 8 的最大處理量-16 + 未執行 IOs 每個連結的磁碟。 如果佇列深度是，應用程式不將足夠 IOs 推系統，然後就會在指定期間內處理較少的量。 換句話說，較少處理量。

例如，在 SQL Server 中設定 MAXDOP 值的 「 4 」 的查詢通知 SQL Server，就可以使用四個核心執行查詢。 SQL Server 會決定最佳佇列中的深度值和數字的核心查詢執行。

*最佳佇列深度*  
更高的佇列中深度值也會有缺點。 如果佇列中深度值太高，應用程式會嘗試驅動更高的 IOPS。 除非應用程式有足夠的能夠 IOPS 常設磁碟，這會產生負面影響應用程式的延遲。 下列公式會顯示 IOPS、 延遲和佇列深度之間的關聯。  
    ![](media/storage-premium-storage-performance/image6.png)

您不應設定佇列深度任何高的值，但最佳的值，而不會影響延遲進行足夠 IOPS 應用程式。 例如，如果應用程式延遲需要 1 毫秒，佇列中所需的深度達成 5000 IOPS，QD = 5000 x 0.001 = 5。

*條紋大量佇列深度*  
條紋區，維護夠佇列深度，如此每個磁碟個別具有最大使用量佇列深度。 例如，請考慮的推入佇列中的深度 2 的應用程式與條紋中有 4 磁碟。 兩個 IO 要求，就會前往兩個磁碟，剩餘兩個磁碟會閒置。 經過的所有的磁碟可能忙碌，因此，設定佇列深度。 下列公式會示範如何判斷佇列中的深度等量的區。  
    ![](media/storage-premium-storage-performance/image7.png)

## <a name="throttling"></a>節流  
Azure 進階版儲存之條款所指定數 IOPS 和處理能力視 VM 大小和您所選擇的磁碟大小而定。 每當您的應用程式嘗試驅動 IOPS 或處理量上方的什麼 VM 或磁碟可以處理這些限制，會節流進階版儲存它。 此清單中降低效能應用程式中的表單。 這可以表示較高的延遲，降低處理量或降低 IOPS。 如果不會節流進階版儲存空間，您的應用程式可能完全超過其資源有哪些能夠達成會失敗。 因此，若要避免效能問題，因為節流，永遠佈建足夠的資源，為您的應用程式。 考慮我們 VM 大小和上述的磁碟大小各節中所討論。 效能會找出資源需要裝載您的應用程式的最佳方式。

## <a name="benchmarking"></a>效能  
效能是模擬不同的工作負載應用程式與衡量每個工作負載的應用程式效能的程序。 使用舊版的一節所述的步驟，您已經收集應用程式的效能需求。 藉由執行效能評估工具 Vm 裝載應用程式上，您可以判斷您的應用程式可以使用進階版儲存空間來達成的效能層級。 在此區段中，我們會提供您的效能標準 DS14 VM Azure 進階版儲存空間的磁碟的範例。

我們使用一般效能評估工具 Iometer 和 FIO，for Windows 和 Linux 分別。 這些工具大量模擬的工作量，例如生產執行多執行緒，測量系統效能。 使用工具您也可以設定參數，例如區塊大小和佇列中深度，您通常不能變更應用程式。 這可讓您更多的彈性高的縮放比例 VM 佈建與不同類型的應用程式工作負載的進階版磁碟上的磁碟機的最大的效能。 若要瞭解更多有關每個效能評估工具瀏覽[Iometer](http://www.iometer.org/)與[FIO](http://freecode.com/projects/fio)。

若要依照下面的範例，建立標準 DS14 VM 並附加 VM 11 進階版儲存空間的磁碟。 11 磁碟，設定為 [無] 快取的主機 10 磁碟和等量這些磁碟區到稱為 NoCacheWrites 音量。 設定主機剩餘的磁碟上的快取為 「 唯讀 」，並建立此磁碟稱為 CacheReads 音量。 使用此設定，您將無法看到從標準 DS14 VM 最大的讀取和寫入效能。 建立進階版磁碟 DS14 VM 的詳細步驟，請移至[建立及使用虛擬機器資料磁碟的進階版儲存帳戶](storage-premium-storage.md#create-and-use-a-premium-storage-account-for-a-virtual-machine-data-disk)。

*準備快取*  
使用快取的唯讀主機磁碟可提供較高的 IOPS 比磁碟的限制。 若要從主應用程式快取取得此最大的讀取的效能，首先您必須準備的磁碟快取。 這樣的哪種效能評估工具會磁碟機 CacheReads 大量閱讀 IOs 實際碰到快取，而且不磁碟直接。 從單一快取的其他 IOPS 快取點擊結果啟用磁碟。

>**重要︰**  
>您必須執行效能，每次重新 VM 之前，先準備快取。

#### <a name="iometer"></a>Iometer   
[下載 Iometer 工具](http://sourceforge.net/projects/iometer/files/iometer-stable/2006-07-27/iometer-2006.07.27.win32.i386-setup.exe/download)VM。

*測試檔案*  
Iometer 使用測試檔案儲存在您將執行的效能評估測試音量。 它磁碟機讀取，並將測量磁碟這個測試檔案 IOPS 和處理量。 如果您沒有提供 Iometer 會建立此測試檔案。 建立 CacheReads 和 NoCacheWrites 區上呼叫 iobw.tst 200 GB 測試檔案。

*存取規格*  
相關規格，要求 IO 大小]，[%讀/寫、 %隨機/連續設定 Iometer 中使用 「 存取規格] 索引標籤。 建立 access 規格的每個所述的案例。 建立 access 相關規格，符合和 [儲存] 以適當的名稱等 RandomWrites\_8 K，RandomReads\_8 K。 執行此測試案例時，請選取 [對應的規格]。

最大撰寫 IOPS 案例的存取規格的範例如下所示，  
    ![](media/storage-premium-storage-performance/image8.png)

*最大 IOPS 測試規格*  
若要示範最大 IOPs，使用較小的要求大小。 使用 8 K 要求大小並建立的隨機撰寫及讀取規格。

| 存取規格 | 要求大小 | 隨機 % | 閱讀 % |
|----------------------|--------------|----------|--------|
| RandomWrites\_8 K     | 8 K           | 100      | 0      |
| RandomReads\_8 K      | 8 K           | 100      | 100    |

*最大處理量測試規格*  
若要示範最大處理量，請使用較大的要求大小。 使用 64k 要求大小並建立的隨機撰寫及讀取規格。

| 存取規格 | 要求大小 | 隨機 % | 閱讀 % |
|----------------------|--------------|----------|--------|
| RandomWrites\_64k    | 64K          | 100      | 0      |
| RandomReads\_64k     | 64K          | 100      | 100    |

*執行 Iometer 測試*  
執行下列步驟來準備快取

1.  使用，以下所示的值建立兩個 access 規格

  	| 名稱              | 要求大小 | 隨機 % | 閱讀 % |
  	|-------------------|--------------|----------|--------|
  	| RandomWrites\_1 MB | 1 MB          | 100      | 0      |
  	| RandomReads\_1 MB  | 1 MB          | 100      | 100    |

2.  執行 Iometer 測試初始化以下列參數的快取磁碟。 使用三個工作執行緒目標音量和佇列中的深度 128。 設定的 [執行時間] 期間的測試來 2hrs 「 測試設定 」] 索引標籤上。

  	| 案例              | 目標音量 | 名稱              | 持續時間 |
  	|-----------------------|---------------|-------------------|----------|
  	| 初始設定磁碟快取 | CacheReads    | RandomWrites\_1 MB | 2hrs     |

3.  執行 Iometer 測試準備中以下列參數的快取磁碟。 使用三個工作執行緒目標音量和佇列中的深度 128。 設定的 [執行時間] 期間的測試來 2hrs 「 測試設定 」] 索引標籤上。

  	| 案例           | 目標音量 | 名稱             | 持續時間 |
  	|--------------------|---------------|------------------|----------|
  	| 準備快取磁碟 | CacheReads    | RandomReads\_1 MB | 2hrs     |

快取磁碟接手之後，請進行下列測試案例。 若要執行 Iometer 測試，請使用至少三個執行緒的**每個**目標音量。 每個工作者執行緒選取目標音量，設定佇列深度，並選取其中一個測試儲存相關規格，符合，如下圖所示，在下表中執行的相對應的測試案例。 執行下列測試時，表格會將預期的結果也顯示的 IOPS 和處理量。 所有情況下，為 8 KB 的小型 IO 大小及高佇列中的深度 128 用於。

| 測試案例      | 目標音量 | 名稱              | 結果       |
|--------------------|---------------|-------------------|--------------|
| 最大值。 了解的 IOPS     | CacheReads    | RandomWrites\_8 K  | 50000 IOPS  |
| 最大值。 撰寫 IOPS    | NoCacheWrites | RandomReads\_8 K   | 64000 IOPS  |
| 最大值。 合併的 IOPS | CacheReads    | RandomWrites\_8 K  | 100000 IOPS |
|                    | NoCacheWrites | RandomReads\_8 K   |              |
| 最大值。 閱讀秒 MB   | CacheReads    | RandomWrites\_64k | 秒 524 MB   |
| 最大值。 撰寫秒 MB  | NoCacheWrites | RandomReads\_64k  | 秒 524 MB   |
| 合併的秒 MB    | CacheReads    | RandomWrites\_64k | 秒 1000 MB  |
|                    | NoCacheWrites | RandomReads\_64k  |              |

以下是 Iometer 的螢幕擷取畫面的測試結果合併 IOPS 與處理案例。

*合併的讀取和寫入的最大 IOPS*  
![](media/storage-premium-storage-performance/image9.png)

*合併的讀取和寫入的最大處理量*  
![](media/storage-premium-storage-performance/image10.png)

### <a name="fio"></a>FIO  
FIO 是 Linux Vm 事先儲存至常用的工具。 若要選取不同的 IO 大小、 連續的彈性或隨機讀取，並將。 它會產生工作者執行緒或執行指定的 I/O 作業的程序。 您可以指定 I/O 執行作業工作執行緒必須使用工作檔案的類型。 我們建立一個每個案例說明在下面的範例中的工作檔案。 您可以變更的相關規格，在基準測試不同的工作負載進階版儲存上執行這些工作檔案。 在範例中，我們會使用標準 DS 14 VM 執行**Ubuntu**。 執行效能評估測試之前，先使用快取[Benchmarking 區段](#Benchmarking)開頭所述和暖色程度的相同設定。

之前開始，請[下載 FIO](https://github.com/axboe/fio) ，並將其安裝在您的虛擬機器。

Ubuntu，執行下列命令

        apt-get install fio

我們將使用四個執行緒以獲得促進寫入作業及四個工作者執行緒磁碟上的行駛讀取作業。 將流量開車寫入同事在 「 無 」 區，其中有 10 磁碟快取設定為 [無]。 讀取同事會在具有 1 磁碟快取設定，為 「 唯讀 」 與 「 readcache 」 音量行駛路線流量。

*最大寫入 IOPS*  
若要取得最大撰寫 IOPS 下列規格建立工作檔案。 將其命名 「 fiowrite.ini 」。

```
[global]
size=30g
direct=1
iodepth=256
ioengine=libaio
bs=8k

[writer1]
rw=randwrite
directory=/mnt/nocache
[writer2]
rw=randwrite
directory=/mnt/nocache
[writer3]
rw=randwrite
directory=/mnt/nocache
[writer4]
rw=randwrite
directory=/mnt/nocache
```

請注意符合各節所述的設計指導方針追蹤重要事項。 這些規格個基本驅動最大 IOPS，  
-   高佇列中的深度 256。  
-   小型的封鎖檔案大小為 8 KB。  
-   執行 [隨機的多執行緒所撰寫。

執行下列命令以開始 FIO 檢定的結果 30 秒  

    sudo fio --runtime 30 fiowrite.ini

測試當執行時，您可以查看數撰寫 IOPS VM 及發表進階版的磁碟。 下列範例所示，DS14 VM 會將其最大寫入 50000 IOPS IOPS 限制。  
    ![](media/storage-premium-storage-performance/image11.png)

*最大讀取 IOPS*  
若要取得最大的讀取 IOPS 下列規格建立工作檔案。 將其命名 「 fioread.ini 」。

```
[global]
size=30g
direct=1
iodepth=256
ioengine=libaio
bs=8k

[reader1]
rw=randread
directory=/mnt/readcache
[reader2]
rw=randread
directory=/mnt/readcache
[reader3]
rw=randread
directory=/mnt/readcache
[reader4]
rw=randread
directory=/mnt/readcache
```

請注意符合各節所述的設計指導方針追蹤重要事項。 這些規格個基本驅動最大 IOPS，

-   高佇列中的深度 256。  
-   小型的封鎖檔案大小為 8 KB。  
-   執行 [隨機的多執行緒所撰寫。

執行下列命令以開始 FIO 檢定的結果 30 秒

    sudo fio --runtime 30 fioread.ini

雖然測試執行時，您會讀取的數目 IOPS VM 和進階版磁碟發表。 下列範例所示，DS14 VM 會將 64000 閱讀 IOPS。 這是磁碟和快取效能的組合。  
    ![](media/storage-premium-storage-performance/image12.png)

*最大值讀取和寫入 IOPS*  
使用下列建立的工作檔案以取得最大的規格結合已讀取和寫入 IOPS。 將其命名 「 fioreadwrite.ini 」。

```
[global]
size=30g
direct=1
iodepth=128
ioengine=libaio
bs=4k

[reader1]
rw=randread
directory=/mnt/readcache
[reader2]
rw=randread
directory=/mnt/readcache
[reader3]
rw=randread
directory=/mnt/readcache
[reader4]
rw=randread
directory=/mnt/readcache

[writer1]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer2]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer3]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer4]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
```

請注意符合各節所述的設計指導方針追蹤重要事項。 這些規格個基本驅動最大 IOPS，

-   高佇列中的深度 128。  
-   4 KB 的小型區塊的大小。  
-   執行 [隨機的多執行緒讀取與寫入。

執行下列命令以開始 FIO 檢定的結果 30 秒

    sudo fio --runtime 30 fioreadwrite.ini

時測試執行時，您可以看到的合併讀取和寫入 IOPS VM，並發表進階版磁碟。 下列範例所示，DS14 VM 會將多個 100000 合併的已讀取和寫入 IOPS。 這是磁碟和快取效能的組合。  
    ![](media/storage-premium-storage-performance/image13.png)

*最大值結合處理量*  
取得最大值組合已讀取和寫入處理能力，請執行讀取和寫入的多執行緒使用較大的區塊大小和大型佇列深度。 您可以使用 64 KB 的區塊大小和 128 佇列深度。

## <a name="next-steps"></a>後續步驟  

深入瞭解 Azure 進階版儲存空間︰

- [Azure 虛擬機器工作負載的進階版儲存空間︰ 高效能儲存空間](storage-premium-storage.md)  

SQL Server 使用者，用於 SQL Server 閱讀文件效能的最佳作法︰

- [效能最佳作法 Azure 虛擬機器中的 SQL Server](../virtual-machines/virtual-machines-windows-sql-performance.md)
- [Azure 進階版儲存提供的 SQL Server Azure VM 中最高的效能](http://blogs.technet.com/b/dataplatforminsider/archive/2015/04/23/azure-premium-storage-provides-highest-performance-for-sql-server-in-azure-vm.aspx) 
