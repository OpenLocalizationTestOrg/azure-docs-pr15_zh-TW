<properties
   pageTitle="Azure 應用程式的可用性 |Microsoft Azure"
   description="技術概觀與設計和 Microsoft Azure 上建立應用程式可用性的相關資訊。"
   services=""
   documentationCenter="na"
   authors="adamglick"
   manager="saladki"
   editor=""/>

<tags
   ms.service="resiliency"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="08/18/2016"
   ms.author="aglick"/>

#<a name="high-availability-for-applications-built-on-microsoft-azure"></a>Microsoft Azure 應用程式的可用性

高度可用的應用程式 absorbs 變動可用性、 載入和相關的服務和硬體暫時失敗。 應用程式會繼續運作可接受的使用者和系統回應層級，所定義的業務需求或應用程式服務等級協定 (Sla)。

##<a name="azure-high-availability-features"></a>Azure 高可用性功能

Azure 有許多內建的平台功能支援高度可用的應用程式。 本節說明一些這些主要功能。 更完整的平台的分析，請參閱[Azure 恢復技術指南](./resiliency-technical-guidance.md)。

###<a name="fabric-controller"></a>布料的轉印圖樣控制器

Azure 布料的轉印圖樣控制器佈建新和監視 Azure 計算執行個體的條件。 布料的轉印圖樣控制器檢查狀態的硬體和軟體主機和來賓電腦執行個體。 偵測到就會失敗，它會強制 Sla 來自動重新放置 VM 執行個體。 進一步的錯誤和升級網域的概念支援計算 SLA。

部署多雲端服務角色執行個體時, Azure 會部署至不同故障網域的這些執行個體。 故障網域邊界基本上是不同的硬體機架相同的區域。 故障網域減少本地化的故障會中斷的服務應用程式的機率。 您無法管理故障網域配置給您的工作或 web 角色數目。 布料的轉印圖樣控制器使用專用與 Azure 裝載的應用程式中的資源。 因為它可以做為 Azure 系統的 nucleus 有 100%的執行時間。 監視，並在故障網域管理角色執行個體。

下圖顯示 Azure 共用的資源，布料的轉印圖樣控制器部署及管理在不同的故障網域。

![簡化的網域隔離錯誤的檢視](./media/resiliency-high-availability-azure-applications/fault-domain-isolation.png)

升級的網域與函數中的錯誤網域相似，但它們支援升級，而不是失敗。 邏輯單位的決定會時間點升級特定服務中的執行個體的執行個體區隔升級的網域。 根據預設，為您的代管的服務部署定義五個升級的網域。 不過，您可以變更該服務定義檔案中的值。 例如，假設您有八個執行個體您網站的角色。 會有三個升級的網域中的兩個執行個體和一個升級的網域中的兩個執行個體。 Azure 定義更新順序，但它所依據的升級的網域數。 如需有關升級的網域的詳細資訊，請參閱[更新雲端服務](../cloud-services/cloud-services-update-azure-service.md)。

###<a name="features-in-other-services"></a>其他服務中的功能

除了支援高計算可用性的平台功能，Azure 內嵌高可用性功能，將其其他服務。 例如，Azure 儲存體維護所有 blob、 表格和佇列中資料的三個的複本。 您也可以儲存備份的二進位大型物件和表格的第二區域中的地理複寫選項。 Azure 內容傳遞網路 」 可讓二進位大型物件快取世界各地的重複性和延展性兩者均適用。 Azure SQL 資料庫維護多個的複本。

除了 [[恢復技術指南](https://aka.ms/bctechguide)系列的文件]，請參閱[最佳作法的設計的大型服務 Azure 雲端服務](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/)（英文）。 這些文章提供更深入的 Azure 平台可用性功能討論。

雖然 Azure 提供多個支援可用性的功能，請務必瞭解其限制︰

- 計算，Azure 可確保您的角色會提供並開始執行，但不是知道您的應用程式是否正在執行或已超過負載。
- Azure SQL 資料庫，資料會同步的區域內複寫。 您可以選擇使用中地理複寫，可讓多達四個額外的資料庫複本中相同的區域 （或不同區域）。 這些資料庫複寫不時間點備份。 SQL 資料庫並提供時間點備份功能。 若要進一步瞭解 SQL 資料庫中時間點功能，請閱讀[Azure SQL 資料庫點時間還原](https://azure.microsoft.com/blog/azure-sql-database-point-in-time-restore/)。
- Azure 儲存空間，表格及 blob 資料複製到替代的地區的預設。 不過，您無法存取複本，直到 Microsoft 選擇無法透過替代的網站。 如果很長一的整個區域的服務中斷，只發生地區容錯移轉還有沒有 SLA 地理容錯次。 也很重要的任何資料損毀快速模式的複本。

基於下列原因，您必須補充與特定應用程式的可用性功能的平台可用性功能。 特定應用程式的可用性功能包括建立時間點備份 blob 資料 blob 快照功能。

###<a name="availability-sets-for-azure-virtual-machines"></a>顯示狀態設定為 Azure 虛擬機器

本文主要著重在雲端服務，為服務 (PaaS) 模式中使用平台。 不過，也有特定的可用功能的 Azure 虛擬機器，即為服務 (IaaS) 模型使用基礎結構。 若要達到可用性搭配虛擬機器，您必須使用可用性集。 可用性設定做發生錯誤，並升級網域類似的功能。 可用性集中 Azure 定位虛擬機器，以防止本地化的硬體錯誤和維護活動停機機器群組中的所有的方式。 可用性集，才能獲得 Azure SLA 可用性的虛擬機器。

下圖提供的兩個可用性集表示該群組網頁和 SQL Server 虛擬機器中，分別。

![顯示狀態設定為 Azure 虛擬機器](./media/resiliency-high-availability-azure-applications/availability-set-for-azure-virtual-machines.png)

>[AZURE.NOTE] 在先前的圖表，SQL Server 是安裝及執行虛擬機器上。 這是前述 Azure SQL 資料庫，提供受管理的服務資料庫的不同。

##<a name="application-strategies-for-high-availability"></a>應用程式可用性的策略

大部分的應用程式策略高可用性涉及 [重複] 或 [移除的應用程式元件間的硬相依性。 設計應用程式應該支援容錯月停機時間 Azure 或協力廠商服務的期間。 下列各節說明增加可用的雲端服務的應用程式模式。

###<a name="asynchronous-communication-and-durable-queues"></a>非同步通訊和長期佇列

請考慮非同步彈性增加 Azure 應用程式中的顯示狀態服務之間的通訊。 在此模式中，寫入的郵件儲存空間佇列] 或 [Azure 服務匯流排佇列稍後處理。 當您撰寫郵件佇列中，以控制立即傳回郵件的寄件者。 另一層的應用程式處理郵件處理，通常是實作工作者角色。 如果工作者角色當機，郵件累積佇列中處理服務已還原之前。 只要使用佇列中，則有前端寄件者和訊息處理器之間沒有直接相依性。 如此可處理量瓶頸分散式應用程式中的同步服務通話的需求。

這一種變化使用 Azure 儲存體 （二進位大型物件、 表格、 佇列）] 或 [服務匯流排佇列為容錯移轉位置失敗的資料庫通話。 例如，同步至其他服務 （例如 Azure SQL 資料庫），應用程式中的呼叫失敗重複。 您可以將該資料序列化為長期儲存空間。 在稍後的服務或資料庫時恢復連線，應用程式可以重新送出要求從儲存空間。 在此模型的差異是中間位置不常部分應用程式工作流程。 只在失敗案例中使用。

在這兩種情況下，非同步通訊和中繼儲存空間，防止降落的停機的後端服務停機整個應用程式。 佇列做為邏輯的中間。 取得更多選擇正確的佇列服務的詳細指示，請參閱[Azure 佇列和 Azure 服務匯流排佇列-比較和相對於](../service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted.md)。

###<a name="fault-detection-and-retry-logic"></a>錯誤偵測和重試邏輯

在設計高度可用的應用程式中的重點是使用程式碼中的 [重試邏輯輕鬆地處理暫時無法使用的服務。 [暫時錯誤處理應用程式區塊](https://msdn.microsoft.com/library/hh680934.aspx)，開發 Microsoft 圖樣及作法小組成員，此程序將協助應用程式開發人員。 Word 」 暫時性 」 表示是暫時僅適用於較短時間持續時間。 在本文的內容，處理暫時性失敗是開發高度可用的應用程式。 暫時條件的範例包括間歇性網路的錯誤和遺失資料庫的連線。

暫時錯誤處理應用程式區塊是以簡化的方式，讓您以正常方式處理您的程式碼中的錯誤。 您可以使用它來新增強大的暫時性錯誤處理邏輯以改善應用程式的可用性。 在大部分情況下，重試邏輯處理簡短中斷，並重新連線一或多個失敗次數之後的寄件者和收件者。 成功重試嘗試通常會忽略應用程式的使用者。

開發人員有三個選項可以管理其重試邏輯︰ 累加、 固定的間隔，和指數。 累加等待再之前每重試增加線性的方式 （例如 1、 2、 3、 4 秒）。 固定的間隔時間等待的同一個每次重試 （例如，2 秒） 之間的時間量。 更多隨機的選項，指數返回關閉等待再重試之間。 不過，它會使用指數行為 （例如，2、 4、 8，及 16 秒）。

在您的程式碼的高層級策略是︰

1. 定義您重試策略和原則。
1. 請嘗試可能會造成的暫時性錯誤的作業。
1. 如果發生暫時性錯誤，叫用重試原則。
1. 如果所有重試失敗，攔截最終的例外狀況。

測試您重試邏輯中模擬的失敗次數，以確保的連續的作業重試不會導致您無法預料的長時間延遲。 決定失敗的整體工作之前執行此動作。

###<a name="reference-data-pattern-for-high-availability"></a>參考資料可用性模式

參考資料是唯讀的應用程式。 此資料提供商務內容的應用程式，請產生商業作業期間的交易資料。 交易資料是一個時間點函數的參考資料。 因此，其完整性取決於參考資料的快照集一次交易。 這是較為寬鬆定義，但它應該可以滿足我們的目的。

在應用程式的內容中的 [參考資料，則需要運作的應用程式。 個別的應用程式建立和維護參考資料。主資料管理 (MDM) 系統通常會執行這項功能。 這些系統負責生命週期的參考資料。 參考資料的範例包含產品目錄、 員工母片、 組件母片] 及設備母片。 參考資料可以來自組織外部的例如郵遞區號或稅費率。 增加可用的參考資料的策略是通常難以比交易資料。 參考資料的優點的大多不變。

您可以進行部署參考資料以及應用程式取用參考資料在執行階段獨立的 Azure 網頁和背景工作角色。 如果這類部署所允許的本機存放區的大小，這是理想的狀態。 Azure 計算刻度] 單位自主會協助內嵌的資料庫 （SQL、 NoSQL） 或部署至本機檔案系統的 XML 檔案。 不過，您應該已更新每一個角色中的資料，而不需要重新部署機制。 若要這麼做，請將 [參考資料至雲端儲存空間端點 （例如，Azure Blob 儲存體或 SQL 資料庫） 的任何更新。 將程式碼新增至每一個下載的資料更新到運算節點角色啟動時的角色。 或者，新增可讓系統管理員，才能執行強制的下載至角色執行個體的程式碼。

若要增加可用性，角色也應該包含參考資料一組以防儲存空間已關閉。 這可讓直到儲存資源變成可用的更新，以基本參考資料一開始的角色。

![透過獨立運算節點的應用程式可用性](./media/resiliency-high-availability-azure-applications/application-high-availability-through-autonomous-compute-nodes.png)

此模式的一個考量是部署和啟動您的角色的速度。 如果您是部署或下載大量參考資料在啟動時，這可以增加新的部署或角色執行個體微調所花費的時間量。 這可能會針對每一個角色無法立即使用的參考資料，而不是根據外部儲存服務自主折衷接受。

###<a name="transactional-data-pattern-for-high-availability"></a>交易資料可用性模式

交易資料是應用程式產生商務內容中的資料。 交易資料是應用程式實作的商務程序及支援這些處理程序的參考資料集的組合。 訂單與進階傳送通知、 發票、 客戶關係管理 (CRM) 商機，可以包含交易資料的範例。 因此產生的交易資料會送出到外部系統記錄保留或進一步處理。

請記住資料可以變更負責這項資料的系統中的參照。 因此，使其最小的外部相依性語意的一致性交易資料時，必須儲存的時間點參考資料內容。 例如，請考慮移除產品類別目錄中的幾個月後訂單已完成。 最佳作法是內嵌交易的多參考資料內容。 即使後擷取交易，變更參考資料，這會保留交易，相關聯的語意。

如先前所述，使用具備彈性和非同步通訊的架構擔任更高的可用性。 這適用於交易的資料，但實作更複雜。 傳統的交易概念通常依賴保證交易的資料庫。 當您介紹中繼的圖層時，應用程式碼必須正確地處理以確保足夠的一致性和持續性的各種層級的資料。

下列程序說明將擷取的交易資料分開處理工作流程︰

1. Web 運算節點︰ 簡報參考資料。
1. 外部的儲存空間︰ 儲存交易的中繼資料。
1. Web 運算節點︰ 完成使用者交易。
1. Web 運算節點︰ 傳送已完成的交易資料，以及 [參考資料內容，以長期暫存保證的預測的回應。
1. Web 運算節點︰ 訊號交易使用者完成。
1. 背景計算節點︰ 擷取交易資料、 後續處理，如有必要，並將其傳送到最後一個儲存位置目前系統。

下圖顯示此設計的可能實作 Azure 裝載雲端服務中。

![透過具備彈性的可用性](./media/resiliency-disaster-recovery-high-availability-azure-applications/application-high-availability-through-loose-coupling.png)

在上圖中的虛線箭號表示非同步處理。 不知道此非同步處理的前端網頁角色。 這會導致最終目的地參照目前系統的交易儲存空間。 由於此非同步模型介紹的延遲，交易的資料不會立即可供查詢。 因此，每單位的交易資料需要快取中儲存或需要符合立即 UI 的使用者工作階段。

Web 角色是獨立的其餘部分基礎結構。 其可用性設定檔是網頁角色和 Azure 佇列中不整個基礎結構的組合。 除了高的顯示狀態，這種方法可讓網頁角色水平縮放亦後端儲存空間。 此高可用性模型可以在上發揮影響力的作業經濟。 Azure 佇列和工作者角色等的附加元件，可能會影響每月的使用狀況成本。

請注意先前的圖表，顯示一個實作交易資料這個低耦合方式。 有許多其他可能實作。 下列清單提供一些替代方案︰

 * 網頁角色和儲存佇列中之間，也可能會放置工作者角色。
 * Azure 儲存體佇列中可以使用服務匯流排佇列。
 * 目的地可能 Azure 儲存體或不同的資料庫提供者。
 * Azure 快取可在網站層級交易後提供立即快取的需求。

###<a name="scalability-patterns"></a>延展性圖樣

請務必注意雲端服務的延展性直接影響可用性。 如果負載增加造成您沒有回應的服務，使用者印象是應用程式當機。 請遵循延展性根據您預期的應用程式載入和未來的期望的最佳作法。 最高的縮放比例牽涉到許多考量，例如使用單一與多個儲存帳戶，跨多個資料庫，共用和快取策略。 深入了解這些模式，請參閱[設計的大型服務上 Azure 雲端服務的最佳作法](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/)。

##<a name="next-steps"></a>後續步驟

本文是一系列的文章著重於[損毀修復和內建在 Microsoft Azure 應用程式的可用性](./resiliency-disaster-recovery-high-availability-azure-applications.md)。 本系列文章會[損毀修復的內建在 Microsoft Azure 應用程式](./resiliency-disaster-recovery-azure-applications.md)。
