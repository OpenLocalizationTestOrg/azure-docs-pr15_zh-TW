<properties
   pageTitle="自動縮放指引 |Microsoft Azure"
   description="如何自動調整大小，以動態方式配置應用程式所需的資源指南。"
   services=""
   documentationCenter="na"
   authors="dragon119"
   manager="christb"
   editor=""
   tags=""/>

<tags
   ms.service="best-practice"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="07/13/2016"
   ms.author="masashin"/>

# <a name="autoscaling-guidance"></a>自動縮放指南

[AZURE.INCLUDE [pnp-header](../includes/guidance-pnp-header-include.md)]

## <a name="overview"></a>概觀
自動縮放執行階段成本最小化時的程序以動態方式配置符合效能需求及符合服務等級協定 (Sla) 的應用程式所需的資源。 當工作的音量規模擴大時，應用程式，可能需要額外的資源，讓它在及時中執行的工作。 如需要 slackens，資源就會以縮小成本，同時仍維護適當的效能與會議 Sla 解除配置。
自動縮放利用的雲端裝載環境 elasticity 時簡化管理負擔。 它會減少需要持續監控系統的效能，並決定如何新增或移除資源運算子。
>[AZURE.NOTE] 自動縮放適用於所有應用程式，而不只是計算資源所使用的資源。 例如，如果您的系統使用訊息佇列傳送及接收資訊，請其無法建立其他佇列擴充。

## <a name="types-of-scaling"></a>縮放的類型
縮放比例通常會使用下列兩種格式的其中一個︰

- **垂直**（通常稱為_縮放比例向上和向下_）。 此表單可讓您必須修改硬體 （擴充或縮減其容量和效能），或重新部署使用另一個具有適當的容量和效能的硬體方案。 在雲端環境中，硬體平台通常是在虛擬的環境。 除非原始的硬體已經大幅 overprovisioned，使用連續的些預先資金費用，此環境中垂直向上涉及佈建功能更強大的資源，然後再移至這些新資源系統。 垂直縮放比例，通常會破壞的程序，需要時重新部署進行系統暫時無法使用。 可能要保留原始系統執行新的硬體已佈建而引進線上，但有可能會有一些中斷時從舊的環境處理切換到新訂閱。 是常見使用自動縮放實作垂直縮放比例策略。
- **水平**（通常稱為_看]，並在 [縮放比例_）。 此表單需要部署上其他方案或較少的資源，通常是商業資源，而不是強大的系統。 解決方案佈建這些資源時，可以繼續執行，而不會中斷。 提供的程序完成時，可以部署在這些額外的資源組成解決方案的項目複本，並提供。 如果需求，可以回收的其他資源後，使用這些項目的擁有完全關閉。 許多雲端系統，包括 Microsoft Azure 支援自動化的縮放此表單。

## <a name="implement-an-autoscaling-strategy"></a>實作自動縮放策略
實作自動縮放策略通常涉及下列元件與處理程序︰

- 記錄和監視應用程式、 服務和基礎結構的層級的系統。 這些系統擷取主要的度量，例如回應時間、 佇列長度、 CPU 使用率和記憶體使用量。
- 可評估監視的縮放比例因素預先定義的系統臨界值或排程，並決定是否要或不按比例縮放的決策邏輯。
- 負責與縮放比例系統，例如佈建或不支援的資源相關的工作的元件。
- 測試、 監控及調整自動縮放策略，以確定如預期般運作。

大部分的雲端環境，例如 Azure 提供的地址常見的案例的內建的自動縮放機制。 如果所需之自動縮放比例] 功能，或如果您有極大自動縮放超出其功能的需求，可能需要自訂實作提供的環境或您使用的服務。 使用此自訂的實作收集操作和系統指標，分析它們，以識別相關的資料，然後根據這一點來調整資源。


## <a name="configure-autoscaling-for-an-azure-solution"></a>設定自動縮放 Azure 解決方案
有數種選項，以設定自動縮放為 Azure 的方案︰

- **Azure 自動調整大小**支援最常見的縮放比例案例根據排程，您也可以觸發 [縮放比例根據執行階段指標 （例如處理器使用率、 佇列長度或內建和自訂計數器） 的作業。 您可以使用 Azure 入口網站，快速且輕鬆設定解決方案的簡單自動縮放的原則。 如需詳細控制項時，您可以進行[Azure 服務管理 REST API](https://msdn.microsoft.com/library/azure/ee460799.aspx)或[Azure 資源管理員 REST API](https://msdn.microsoft.com//library/azure/dn790568.aspx)。 [Azure 監視服務管理文件庫](http://www.nuget.org/packages/Microsoft.WindowsAzure.Management.Monitoring)（中預覽版本） 的[Microsoft 獲得深入見解文件庫](https://www.nuget.org/packages/Microsoft.Azure.Insights/)是 Sdk 所允許收集計量從不同的資源，並利用 REST Api 來執行自動縮放。 資源的 Azure 資源管理員支援無法使用，或是如果您使用的 Azure 雲端服務，服務管理 REST API 可自動調整。 在所有其他的情況下，使用 [Azure 資源管理員]。
- **自訂解決方案**，根據您在應用程式與管理功能的 Azure 儀器會有幫助的。 例如，您可以使用 Azure 診斷或儀器的其他方法中應用程式，以及持續監控和匯出的應用程式的計量自訂程式碼。 您可以使用下列指標，及使用的服務管理的自訂規則或資源管理員 REST API 的觸發自動縮放。 觸發的縮放比例作業指標可以是任何內建或自訂計數器或您的應用程式中執行其他儀器。 不過，並不容易實作，自訂解決方案，應該考量只是否沒有任何之前的方法可以完成您的需求。 [自動縮放應用程式區塊](http://msdn.microsoft.com/library/hh680892%28v=pandp.50%29.aspx)使用此方法。
- **協力廠商服務**，例如[Paraleap AzureWatch](http://www.paraleap.com/AzureWatch)，可讓您調整排程、 服務載入與系統效能指標、 自訂規則，以及組合不同類型的規則為基礎的解決方案。

在選擇要採用哪一個自動縮放解決方案時，請考慮下列幾點︰

- 使用內建的自動縮放功能的平台，符合您的需求。 如果沒有的話，請仔細考慮您是否真的執行需要更複雜的縮放功能。 其他需求的部分範例可能包含控制項，偵測觸發事件的縮放比例與訂閱，縮放比例縮放其他類型的資源的不同方式的詳細資料粒的度。
- 請考慮您是否能夠足夠的精確度到僅取決於排定自動縮放 （新增及移除符合預期的最大使用量中指定的執行個體） 來預測應用程式上的載入。 這不可能的話，使用被動式自動縮放根據收集在執行階段，以允許處理發生無法預期的變更，視需要在應用程式的指標。 一般而言，您可以結合這種方法。 例如，建立可新增資源，例如計算、 儲存及佇列，根據您知道應用程式是最忙碌時間的策略。 如此有助於確保容量可用時所需，而不會啟動新的執行個體時所發生的延遲。 此外，請針對每個排程的規則，定義允許被動式自動縮放以確保應用程式可以處理持續但發生無法預期尖峰，視需要在此期間的指標。
- 很難瞭解指標與容量需求，尤其是初次部署應用程式之間的關係。 想要提供一些額外的容量開頭，然後監控和微調自動縮放規則的實際負載帶往容量。

### <a name="use-azure-autoscale"></a>使用 Azure 自動調整大小
自動調整大小可讓您設定時的縮放比例，並不按比例縮放的解決方案的選項。 自動調整大小可以自動新增和移除 Azure 應用程式服務中的 [Azure 雲端服務 web 和工作者角色、 Azure 行動服務與 Web 應用程式功能的執行個體。 也可以由啟動和停止執行個體的 Azure 虛擬機器自動縮放比例。 Azure 自動縮放策略包含兩組因素︰

- 可以確保其他執行個體的排程為基礎的自動縮放可提供給符合預期的最大使用量的使用狀況]，然後中可以調整後的最大使用量時間已經過了。 這可讓您合作以確保您有足夠的執行個體正在執行，而不需等待回應載入系統。
- 指標型自動縮放回應各種因素平均的 CPU 使用率，移至最後一個小時或為待處理的解決方案處理 Azure 儲存空間或 Azure 服務匯流排佇列中的郵件。 這個選項可讓應用程式從 [排定自動縮放規則，以容納非預期或無法預料視需要變更個別回應。

使用自動調整大小，請考慮下列幾點︰

- 您的自動縮放策略結合排程和指標型縮放比例。 您可以指定這兩種服務的規則。
- 您應該設定自動縮放規則]，然後監控效能的一段時間的應用程式。 您可以使用此監視結果來調整如有必要，調整系統的方式。 不過，請記住，自動縮放不是瞬間完成的效能的程序。 所花的時間來回應度量單位，例如 average CPU 使用率超過 （或達） 指定臨界值。
- 自動縮放規則使用偵測機制根據測量的觸發程序屬性 （例如 CPU 使用狀況] 或 [佇列長度） 的時間，而不是瞬間完成的效能的值，透過使用彙總的值，觸發自動縮放動作。 根據預設，將彙總是數值的平均值。 這會從迅速地反應或造成快速 oscillation。 您也可以為新的執行個體的是自動啟動解決執行模式，防止其他自動縮放動作發生時，會啟動新的執行個體中的時間。 Azure 雲端服務與 Azure 虛擬機器彙總的預設期間是 45 分鐘，因此就可以在這段時間的公制要觸發在回應中指定的波峰上自動縮放。 您可以使用 sdk，您可以變更的彙總期間，但請注意少於 25 分鐘的時間，可能會造成無法預期的結果 （如需詳細資訊，請參閱[自動 CPU 百分比與 Azure 監視服務管理文件庫上的縮放比例雲端服務](http://rickrainey.com/2013/12/15/auto-scaling-cloud-services-on-cpu-percentage-with-the-windows-azure-monitoring-services-management-library/)）。 Web Apps 平均的期間是較短，可在 5 分鐘關於平均的觸發程序量值變更後的新執行個體。
- 如果您設定自動縮放使用 SDK，而不是 web 入口網站，您可以指定詳細的排程期間是作用中的規則。 您也可以建立您自己的準則，並包含或不含任何現有的自動縮放規則中使用它們。 例如，您可以使用替代計數器，例如每個第二或平均記憶體的顯示狀態，要求的數字或使用自訂計數器量特定商務程序。
- 自動縮放 Azure 虛擬機器中，您必須部署的執行個體的虛擬機器等於最大的數字時可讓自動縮放開始。 這些執行個體必須屬於相同的可用性集。 虛擬機器自動縮放機制不會建立或刪除的虛擬機器; 執行個體不過，您設定的自動縮放規則會啟動和停止這些執行個體中適當的數目。 如需詳細資訊，請參閱[自動調整執行 Web 角色、 工作者角色或虛擬機器應用程式](./cloud-services/cloud-services-how-to-scale.md)。
- 如果無法開始新的執行個體，可能是因為已達訂閱的最大值，或是在啟動時，發生錯誤入口網站可能會顯示自動縮放作業成功。 不過，在入口網站中所顯示的後續**ChangeDeploymentConfiguration**事件會顯示只啟動服務要求，，而且會有任何事件，代表已順利完成。
- 若要連結至計算服務執行個體的資源，例如 SQL 資料庫執行個體和佇列，您可以使用入口網站的使用者介面。 這個選項可讓您更輕鬆地存取另外一份手動和自動縮放比例設定為每個連結的資源的選項。 如需詳細資訊，請參閱[如何︰ 連結至雲端服務的資源](cloud-services-how-to-manage.md#linkresources)，以及[如何調整應用程式](./cloud-services/cloud-services-how-to-scale.md)。
- 當您設定多個原則和規則時，它們可能會與彼此衝突。 自動調整大小會使用下列的衝突解決規則，以確保有永遠足執行之執行個體︰
  - 縮放比例作業優先於作業。
  - 當延展作業衝突，初始的執行個體數目最大增加規則的優先順序。
  - 在作業衝突時縮放、 起始號碼的執行個體中的最小減少規則的優先順序。

<a name="the-azure-monitoring-services-management-library"></a>

## <a name="application-design-considerations-for-implementing-autoscaling"></a>應用程式實作自動縮放的設計考量
自動縮放無法立即的解決方案。 只要將資源新增至系統或執行更多的執行個體的程序，並不保證系統效能，藉此改善。 設計自動縮放策略時，請考慮下列幾點︰

- 在設計系統時，必須水平調整。 避免設想執行個體相關性。不要設計解決方案，需要的程式碼永遠在特定的執行個體的程序執行。 水平縮放到雲端服務或網站時，不假設一系列的相同的來源要求一律會路由至相同的執行個體。 同樣地，設計服務狀態請避免使用一系列的應用程式，永遠傳送至相同的執行個體的服務要求。 設計時從佇列中讀取郵件，並加以處理的服務，不進行任何假設服務控點的執行個體的特定訊息。 當佇列長度規模擴大時，自動縮放無法啟動服務的其他執行個體。 [競爭消費者圖樣](http://msdn.microsoft.com/library/dn568101.aspx)說明如何處理這種情況。
- 如果解決方案實作長時間執行工作，設計此工作給支援擴展和縮放比例。 到期日不小心，例如工作無法防止程序的執行個體關閉完全時系統縮放中，或如果強制結束程序，它可能會遺失資料。 理想的情況下，重整長時間執行工作，分割成更小的不連續區塊執行的程序。 [管線與篩選模式](http://msdn.microsoft.com/library/dn568100.aspx)提供達到此的範例。
- 或者，您可以執行的檢查點機制記錄狀態定期間隔，任務的相關資訊，以及儲存可以存取的任何處理程序執行工作的執行個體的長期儲存此狀態。 如此一來，如果處理程序是關機，它所執行的工時可以繼續最後檢查點從使用另一個執行個體。
- 背景的工作上執行時計算個別執行個體，例如在工作中的雲端服務的角色裝載於應用程式，您可能需要調整不同部分使用不同的縮放比例原則的應用程式。 例如，您可能需要部署額外的使用者介面 (UI) 計算執行個體，而不增加的背景數計算執行個體或這相反。 如果您提供不同層級的服務 （例如基本和付費服務套件），您可能需要計算資源的進階版服務套件，瞭解基本服務套件比積極縮放以符合 Sla。
- 請考慮使用佇列中的使用者介面和背景計算作為準則的自動縮放策略通訊的執行個體的長度。 這是最佳的指標不平衡或目前的載入與處理能力的背景工作之間的差異。
- 如果您的自動縮放策略根據計數器測量商務程序，例如每小時] 或 [平均執行時間在複雜的交易的訂單的數目，確保您完全瞭解的計數器的下列類型的結果與實際計算容量需求之間的關係。 可能需要來縮放多個元件或計算單位回應商務程序計數器中的變更。  
- 若要防止系統嘗試擴充極，並以避免與執行數以千計的執行個體相關聯的成本，請考慮限制可以自動新增的執行個體數目上限。 大多數的自動縮放機制可讓您指定規則的執行個體最小值和最大數目。 此外，請考慮正常折損系統提供如果已部署的執行個體數目上限，和系統仍超載的功能。
- 請記住，自動縮放可能無法處理突然突發工作負載中的最適合機制。 佈建和開始新的執行個體的服務或新增資源至系統，要花的時間和最大使用量 demand 可能通過這些額外的資源所做的時間。 在此案例中，可能會比較好節流服務。 如需詳細資訊，請參閱[節流圖樣](http://msdn.microsoft.com/library/dn589798.aspx)。
- 相反地，如果您需要容量音量有快速，並成本不重要的關鍵因素處理所有的要求，請考慮使用更快速地啟動其他執行個體的積極自動縮放策略。 您也可以使用排程的原則，以啟動足夠的執行個體，以符合最大負載之前必須是該載入數字。
- 自動縮放機制應該監視自動縮放程序，並登入的每個自動縮放事件詳細資料 (觸發它，新增或移除，哪些資源和時間)。 如果您建立自訂的自動縮放機制，確保它併入此功能。 分析的資訊可協助量值的自動縮放策略效率，並調整必要。 隨著使用模式變得更明顯，、 超出長期，展開企業或應用程式的需求不同時，您可以調整簡短的字詞，兩者。 如果應用程式達到自動調整定義的上限，機制也可能會警示運算子人員無法在必要時手動啟動其他的資源。 請注意，在下列情況下，運算子也可以手動移除這些資源之後的工作量減輕。

## <a name="related-patterns-and-guidance"></a>相關的模式和指引
下列模式和指引也可能是您的狀況相關實作自動縮放時︰

- [節流圖樣](http://msdn.microsoft.com/library/dn589798.aspx)。 這個模式中，將說明如何運作，並視需要增加極大的載入放到資源時，符合 Sla 繼續應用程式。 節流可以搭配自動縮放以防止系統的不知所措，而系統將。
- [競爭消費者圖樣](http://msdn.microsoft.com/library/dn568101.aspx)。 這個模式會說明如何實作可以處理郵件從任何應用程式執行個體的服務執行個體的集區。 自動縮放可用來啟動和停止服務執行個體，以符合預期的工作量。 這種方法可讓系統處理多封郵件同時以最佳化處理量，改善延展性和顯示狀態，然後平衡的工作量。
- [記錄和遙測指引](http://msdn.microsoft.com/library/dn589775.aspx)。 記錄和遙測是相當收集的資訊，可以驅動自動縮放程序。

## <a name="more-information"></a>詳細資訊
- [如何調整應用程式](./cloud-services/cloud-services-how-to-scale.md)
- [自動調整應用程式執行 Web 角色、 工作者角色或虛擬機器](cloud-services-how-to-manage.md#linkresources)
- [如何︰ 連結至雲端服務的資源](cloud-services-how-to-manage.md#linkresources)
- [不按比例縮放連結的資源](./cloud-services/cloud-services-how-to-scale.md#scale-link-resources)
- [Azure 監視服務管理文件庫](http://www.nuget.org/packages/Microsoft.WindowsAzure.Management.Monitoring)
- [Azure 服務管理 REST API](http://msdn.microsoft.com/library/azure/ee460799.aspx)
- [Azure 資源管理員 REST API](https://msdn.microsoft.com/library/azure/dn790568.aspx)
- [Microsoft 的深入見解文件庫](https://www.nuget.org/packages/Microsoft.Azure.Insights/)
- [自動縮放作業](http://msdn.microsoft.com/library/azure/dn510374.aspx)
- [Microsoft.WindowsAzure.Management.Monitoring.Autoscale 命名空間](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.management.monitoring.autoscale.aspx)
