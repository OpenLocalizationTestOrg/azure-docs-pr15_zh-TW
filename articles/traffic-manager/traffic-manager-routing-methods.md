<properties
    pageTitle="流量管理員-流量路由方式 |Microsoft Azure"
    description="此文章可協助您瞭解由流量管理員不同的流量路由方法"
    services="traffic-manager"
    documentationCenter=""
    authors="sdwheeler"
    manager="carmonm"
    editor=""
/>
<tags
    ms.service="traffic-manager"
    ms.devlang="na"
    ms.topic="article"
    ms.tgt_pltfrm="na"
    ms.workload="infrastructure-services"
    ms.date="10/11/2016"
    ms.author="sewhee"
/>

# <a name="traffic-manager-traffic-routing-methods"></a>流量管理員傳輸路由的方法

Azure 流量管理員支援傳輸路由的三種方法，以決定如何將網路流量路由至不同的服務端點。 流量管理員適用於收到每個 DNS 查詢的流量路由的方法。 傳輸路由的方法會決定 DNS 回應中傳回的結束點。

Azure 資源管理員支援的資料傳輸 Manager 會使用不同的術語比傳統部署模型。 下表顯示資源管理員] 及 [傳統字詞之間的差異︰

| 資源管理員字詞 | 傳統的字詞 |
|-----------------------|--------------|
| 傳輸路由的方法 | 負載平衡的方法 |
| 優先順序方法 | 容錯移轉方法 |
| 加權的方法 | 循環方法 |
| 效能方法 | 效能方法 |

我們根據客戶意見反應，變更改進並減少常見誤解的術語。 沒有任何功能的不同。

方法有三種流量路由流量管理員中可用︰

- **優先順序︰**當您要使用的主要服務端點所有流量，並提供備份，以防主要或備份的結束點無法，請選取 [優先順序]。
- **加權︰**選取 「 加權' 當您要分散端點的一組流量時，請平均或根據 [線寬]，即您定義。
- **效能︰**必須在不同地理位置結束點，而您想要使用 「 最接近的 「 端點龐大的最低的網路延遲的使用者，請選取 '效能'。

所有流量管理員設定檔，都包括監視端點健康狀況和自動端點容錯移轉。 如需詳細資訊，請參閱[流量管理員端點監控](traffic-manager-monitoring.md)。 在單一流量管理員設定檔，可以使用只有一個資料傳輸路由的方法。 在任何時候，您可以針對您的設定檔選取不同的資料傳輸路由的方法。 變更會套用一分鐘的時間內，並不所產生。 使用巢狀的流量管理員設定檔，可以合併傳輸路由的方法。 巢狀結構可讓複雜和彈性流量路由組態符合較大的複雜的應用程式的需求。 如需詳細資訊，請參閱[巢狀的流量管理員設定檔](traffic-manager-nested-profiles.md)。

## <a name="priority-traffic-routing-method"></a>優先順序傳輸路由的方法

通常組織想要提供其服務可靠性以部署一或多個備份的服務，以免其主要服務中斷。 [優先順序] 流量路由方法可讓 Azure 客戶很容易地執行這個容錯移轉模式。

![Azure 流量管理員 」 優先順序' 傳輸路由的方法][1]

流量管理員設定檔的內容服務端點的優先順序的清單。 根據預設，流量管理員會傳送至主要 （最高優先順序） 端點所有流量。 如果無法使用的主要端點，流量管理員會將流量路由至第二個端點。 如果無法使用 [主要和次要結束點，則流量移到第三個，依此類推。 可用的端點為基礎的設定的狀態 （啟用或停用），並進行中的端點監控。

### <a name="configuring-endpoints"></a>設定結束點

使用 Azure 資源管理員中，您設定的每個端點使用 [優先順序] 屬性的端點優先順序。 這個屬性是介於 1 和 1000年之間的值。 較低值代表較高的優先順序。 結束點無法共用優先順序值。 將屬性設定為選用步驟。 當被省略了，則會使用根據端點順序的預設優先順序。

傳統介面，端點優先順序會隱含地設定。 優先順序根據端點所示的設定檔定義的順序。

## <a name="weighted-traffic-routing-method"></a>加權的傳輸路由的方法

「 加權 」 的傳輸路由方法可讓您要平均地分配流量或使用預先定義的加權。

![Azure 流量管理員 」 加權' 流量路由方法][2]

在加權流量路由方法中，您可以指派粗細流量管理員設定檔設定每個端點。 粗細是從 1 到 1000 之間的整數。 此參數是選擇性的。 如果省略，流量管理員會使用預設的粗細 '1'。

每個 DNS 查詢收到，流量管理員隨機選擇可用的結束點。 選擇端點的機率為基礎的權重所有可用的端點。 所有的結束點結果為偶數流量分配中使用相同的寬度。 在特定的端點上使用高或較低線寬會使那些較多或較少常用 DNS 回應中傳回的端點。

加權的方法可讓一些實用的案例︰

- 逐漸應用程式升級︰ 配置百分比的傳輸路由至新的結束點，並會逐漸增加一段時間為 100%的流量。
- Azure 移轉應用程式︰ 使用 Azure 和外部端點建立設定檔。 調整結束點到想要新增結束點的權重。
- 雲端爆裂額外容量︰ 快速將它放到前流量管理員設定檔中展開到雲端的內部部署。 當您需要額外的容量在雲端時，您可以新增或啟用端點，指定流量的哪些部分移至每個端點。

新的 Azure 入口網站支援加權的傳輸路由的設定。 在 [傳統] 入口網站中無法設定線寬]。 您也可以設定使用資源管理員與傳統的 PowerShell 的 Azure、 CLI 和版本 REST Api 的權重。

請務必瞭解 DNS 回覆會在用戶端和用戶端使用 dns 名稱解析遞迴 DNS 伺服器快取。 此快取可以在上發揮影響力加權的流量散佈。 大型的用戶端和遞迴 DNS 伺服器數時，如預期般運作流量通訊群組。 不過，小型的用戶端或遞迴 DNS 伺服器數時，快取可以大幅扭曲流量通訊群組。

常見的使用情況包括︰

- 開發和測試環境
- 應用程式至應用程式的通訊
- 縮小的使用者-底數共用常見遞迴 DNS 基礎結構 （例如，透過 proxy 連線的公司員工） 的目標應用程式

這些 DNS 快取效果都有所有的 DNS 傳輸路由系統，而不只是 Azure 流量管理員。 在某些情況下，明確清除 DNS 快取可能會提供因應措施。 在其他情況下，可能會更適當的傳輸路由的替代方法。

## <a name="performance-traffic-routing-method"></a>效能傳輸路由的方法

全球的部署兩個或多個位置中的端點可以改善許多應用程式回應的能力路由流量至 「 最接近 「 您的位置。 '效能' 流量路由方法提供這項功能。

![Azure 流量管理員 '效能' 傳輸路由的方法][3]

「 最接近的 「 結束點不一定是最接近依地理距離條件測量。 而 '效能' 流量路由方法判斷最接近的端點測量網路延遲。 流量管理員維護網際網路延遲表來追蹤每個 Azure 資料中心 IP 位址範圍之間的來回時間。

流量管理員查閱 DNS 要求網際網路延遲資料表中的來源 IP 位址。 流量管理員選擇可用端點 Azure 資料中心的具有最低的延遲的 IP 位址範圍，然後在 DNS 回應中傳回的結束點。

所述[流量管理員的運作方式](traffic-manager-how-traffic-manager-works.md)，流量管理員沒有收到 DNS 查詢直接從用戶端。 而 DNS 查詢來自遞迴 DNS 服務的用戶端設定為使用。 因此，IP 位址用來決定 「 最接近的 「 結束點不是用戶端 IP 位址，但是是遞迴 DNS 服務的 IP 位址。 實際上，這個 IP 位址是很好 proxy 的用戶端。

流量管理員定期更新網際網路延遲表格帳戶全域網際網路和新的 Azure 區域中的變更。 不過，應用程式的效能不盡相同根據載入即時變化，在網際網路上。 效能流量路由不會監視載入指定的服務端點上。 不過，如果無法使用端點，流量管理員會不是它在 DNS 查詢回應。

請注意的事項︰

- 如果您的設定檔包含相同的 Azure 區域中的多個端點，然後流量管理員分配流量平均可用的結束點，在該區域。 如果您偏好不同的流量分配區域內，您可以使用[巢狀的流量管理員設定檔](traffic-manager-nested-profiles.md)。

- 如果指定的 Azure 區域中的所有啟用的端點會降低，流量管理員將流量分散到所有其他可用的端點，而不是下一步最接近的結束點。 此邏輯可防止階層式錯誤發生不超載 [下一步最接近的結束點。 如果您想要定義慣用的容錯移轉順序，請使用[巢狀的流量管理員設定檔](traffic-manager-nested-profiles.md)。

- 使用時的效能流量路由方法與外部的結束點或巢狀的端點，必須先指定這些結束點的位置。 選擇 [部署至最接近的 Azure 地區]。 這些位置是支援網際網路延遲表所列的值。

- 選擇端點演算法是確定。 從相同的用戶端的重複的 DNS 查詢會導向至相同的端點。 一般而言，用戶端時在移動中使用不同的遞迴 DNS 伺服器。 用戶端可能會路由至不同的端點。 路由也可以更新至網際網路延遲資料表的影響。 因此，效能流量路由方法不保證用戶端隨時路由傳送至相同的端點。

- 網際網路延遲表格變更時，您可能會發現部分客戶會導向至不同的端點。 根據目前的延遲資料，此路由變更並提供更精確。 這些更新的基本網際網路不斷發展大小時維持效能傳輸路由的精確度。

## <a name="next-steps"></a>後續步驟

瞭解如何開發高可用性使用[流量管理員端點監視](traffic-manager-monitoring.md)的應用程式

瞭解如何[建立流量管理員設定檔](traffic-manager-manage-profiles.md)

<!--Image references-->
[1]: ./media/traffic-manager-routing-methods/priority.png
[2]: ./media/traffic-manager-routing-methods/weighted.png
[3]: ./media/traffic-manager-routing-methods/performance.png
