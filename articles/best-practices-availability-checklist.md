<properties
   pageTitle="可用性檢查清單 |Microsoft Azure"
   description="提供的指導可用性疑慮在設計期間的檢查清單。"
   services=""
   documentationCenter="na"
   authors="dragon119"
   manager="masimms"
   editor=""
   tags=""/>

<tags
   ms.service="best-practice"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="07/13/2016"
   ms.author="masashin"/>

# <a name="availability-checklist"></a>可用性檢查清單

[AZURE.INCLUDE [pnp-header](../includes/guidance-pnp-header-include.md)]

## <a name="application-design"></a>應用程式的設計

- **避免任何單一的失敗。** 為多個執行個體，若要防止單一的失敗影響可用性應該部署所有元件、 服務、 資源及計算執行個體。 這包含驗證機制。 設計使用多個執行個體，，以自動偵測失敗，並將要求重新導向至非失敗的執行個體位置平台無法執行此自動設定的應用程式。
- **分解每個不同的服務等級協定的工作量。** 如果服務組成的要徑與比較不重要的工作負載，以不同的方式管理它們，然後指定服務功能和符合其可用性需求的執行個體數目。
- **最小化，並瞭解服務的相依性。** 最小化，盡可能使用不同的服務的數目，並確保您瞭解各項的功能及服務的相依性，存在於系統。 這包含這些相依性，性質與失敗的影響，或減少每個整體的應用程式中的效能。 Microsoft 至少保證 99.9%的可用性的大部分的服務，但這表示的每個應用程式可能依賴的其他服務降低的整體可用性 SLA 系統的 0.1 的百分比。
- **設計工作以及在可能是冪 （安全地可重複） 的郵件**，讓的重複要求並不會導致問題。 例如，服務可以做為消費者處理為要求其他系統的部分做為生產者所傳送的郵件。 如果消費者失敗之後處理郵件，但之前認可已處理過，產生者可能會提交重複要求無法處理的消費者用另一個執行個體。 因此，消費者與執行的作業應該冪，以便重複先前已執行的作業完全無法呈現結果無效。 這可能是偵測重複的郵件，或使用一個樂觀工期的方法，處理衝突確保一致性。
- **使用郵件代理人實作要徑交易的可用性。** 起始工作或存取遠端服務的許多情況下使用訊息傳遞應用程式與目標服務之間的指示。 為獲得最佳效能，應用程式應該能傳送的郵件，然後再回到處理更多的要求，而不需要等待回覆。 若要確保傳送的郵件，請郵件系統應提供高可用性。 Azure 服務匯流排訊息佇列實作_至少一次_語意。 這表示張貼到佇列中的每一封郵件將不會遺失，雖然可能會在某些情況下傳送重複的複本。 如果郵件處理冪 （請參閱上一個項目），重複傳遞不應該問題。
- **設計應用程式，以正常方式降低**當資源限制，以及適當採取的動作不讓其與使用者的影響。 在某些情況下，載入到應用程式可能會超過一個的容量或其他部分，導致精簡可用性和失敗的連線。 縮放比例可協助減輕這項目，但它可能會碰到其他因素，例如資源可用性] 或 [成本限制。 設計應用程式，以便在此情況下，可能會自動降低正常。 例如，在商務系統中，如果訂單處理子系統下疲勞 （或甚至完全失敗），它可以暫時停用時允許其他功能 （例如瀏覽產品類別目錄） 若要繼續。 可能適合延後失敗子系統，例如仍啟用 [送出訂單的客戶，但儲存為稍後處理、 訂單子系統再次可用時要求。
- **妥善處理快速突發事件。** 大部分的應用程式需要一段時間，例如先的上午的商務應用程式，或新產品已發行商務網站中處理不同的工作量。 自動調整大小可協助處理負載，但可能需要一些時間上線並處理要求其他執行個體。 防止活動的突發和非預期的高速量充斥應用程式︰ 設計其佇列中使用的服務的要求，並能適當降級佇列何時快完整的容量。 請確定有足夠的效能與容量可用的非尖峰清空佇列和處理未完成的要求的情況下。 如需詳細資訊，請參閱[佇列型負載撫平模式](https://msdn.microsoft.com/library/dn589783.aspx)。

## <a name="deployment-and-maintenance"></a>部署及進行的維修作業

- **部署多個執行個體的每個服務的角色。** Microsoft 對可用性提供的服務，您建立並部署，但這些保證才有效，如果您部署至少兩個執行個體的每個服務中的角色。 這可讓其他仍為作用中時，無法使用其中一個角色。 這是特別重要事項如果您要部署即時系統的更新，而不會中斷用戶端的活動。可以記下和個別升級，而其他人在線上繼續執行個體。
- **多個資料中心的主應用程式。** 雖然不太，可能是整個資料中心的離線透過事件，例如自然損毀或網際網路失敗。 在多個資料中心，以提供最大值的顯示狀態，應會裝載重要的商務應用程式。 這也可以縮減延遲本機的使用者，並更新應用程式時提供其他具彈性的機會。
- **自動化並測試部署及維護工作。** 必須共同作業的多個部分包含的分散式應用程式。 部署應該因此自動，例如指令碼及部署應用程式的測試而證明機制。 這些可以更新驗證設定]，並自動部署程序。 自動化的技巧應用於執行的全部或部分的應用程式的更新。 請務必測試所有的完整以確保錯誤不會造成其他停機時間這些處理程序。 所有部署工具必須都有適當的安全性限制來保護部署的應用程式。定義謹慎強制執行部署原則和最小化需要有人可以操作。
- **請考慮使用執行與生產平台功能**，皆可。 例如，使用 Azure Cloud Services 執行與生產環境可讓應用程式，以切換一到另一個立即透過虛擬的 IP 位址交換 （VIP 交換）。 不過，如果您想要的階段於內部部署，或同時部署不同版本的應用程式並逐漸移轉使用者，您可能無法使用 VIP 交換作業。
- **套用設定變更，而不回收**時可能的執行個體。 在許多情況下，您可以變更 Azure 應用程式或服務設定的設定，而不需要重新啟動的角色。 角色公開可以處理以偵測設定變更，並將其套用至應用程式中的元件的事件。 不過，核心平台設定的一些變更，並需要重新啟動角色。 在建置元件和服務時，最大化可用性和設計他們接受設定的設定變更，而不需要整個重新啟動應用程式以將停機時間最小化。
- **在 [更新時使用零停機時間升級的網域。** Azure 計算單位，例如網頁和工作者角色配置給升級網域。 升級網域角色執行個體組成群組在一起，讓的積存更新發生時停止、 更新，並在重新啟動升級的網域中的每一個角色。 這會影響應用程式的可用性。 您可以指定部署服務時，應該服務建立多少升級的網域。

    > [AZURE.NOTE] 角色也分佈故障網域，每一個都是從伺服器機架、 power，及製冷佈建，才會影響所有角色執行個體失敗的機率最小化的其他故障網域合理獨立。 此分配的自動出現，您無法控制它。

- **設定可用性 Azure 虛擬機器。** 將兩個或多個虛擬機器放在同一個可用性設定可確保這些虛擬機器不會部署至相同的錯誤網域。 最大化顯示狀態，您應該建立的每個要徑的虛擬機器，使用您的系統的多個執行個體，並在相同的可用性設定將這些執行個體。 如果您正在執行多個不同用途的虛擬機器，建立為每個虛擬機器可用性。 將每個可用性設定中的每個虛擬機器執行個體。 例如，如果您已建立個別的虛擬機器作為網頁伺服器，並在報表伺服器] 建立為網頁伺服器可用性和其他可用性報表伺服器的設定。 新增網頁伺服器虛擬機器網頁伺服器的可用性的執行個體設定，以及將報表伺服器虛擬機器的執行個體新增至報表伺服器可用性設定。

## <a name="data-management"></a>資料管理

- **利用資料複寫**完成本機和地理重複。 Azure 儲存體中的資料會自動複寫到保護基礎結構失敗時遺失，您可以設定此複寫有些部分。 例如，可能會在一個以上的地理區域 （稱為讀取權限全域多餘的儲存空間或 RA GRS） 中複製資料的唯讀複本。 請注意，使用 RA GRS 必須支付額外費用。 如需詳細資訊，請參閱[Azure 儲存體價格](https://azure.microsoft.com/pricing/details/storage/)。
- **使用樂觀和一致性**可能的位置。 交易封鎖透過鎖定 （封閉式並行） 資源的存取權會造成效能不佳，並且大幅降低的可用性。 這些問題會變得特別是嚴重分散式系統中。 在許多情況下，謹慎設計和技巧，例如分割可以最小化的發生衝突的更新。 資料複製，或從分別更新商店為唯讀，才會最後一致的資料。 但優點通常遠超過可用性一致性立即使用交易的影響。
- **使用定期備份與還原時間點**，並確保其符合復原指向目標 (RPO)。 定期自動備份資料，不會保留其他位置，並確認您可以可靠還原的資料和應用程式本身應該發生失敗。 資料複寫不備份的功能，因為所有商店複寫錯誤與透過失敗 」、 「 錯誤 」 或 「 惡意作業的不一致性。 備份的程序必須是安全保護資料在傳輸時會和儲存空間。 資料庫或部分的資料存放區通常復原上一個點時間使用交易記錄檔。 Microsoft Azure 提供的資料儲存在 Azure SQL 資料庫備份的設備。 資料匯出至 Azure blob 儲存體，在備份套件，且可以下載至安全內部部署的位置儲存空間。
- **啟用高可用性] 選項，若要維持 Azure Redis 快取第二份。** 使用 Azure Redis 快取，請選擇 [維護第二份內容的標準選項]。 如需詳細資訊，請參閱[建立 Azure Redis 快取中的快取](https://msdn.microsoft.com/library/dn690516.aspx)。

## <a name="errors-and-failures"></a>錯誤與失敗

- **介紹逾時的概念。** 服務和資源可能會無法使用，導致失敗的要求。 請確定您所套用的逾時所適用的每個服務或資源以及存取他們的用戶端。 （在某些情況下，可能適合用於允許特定的執行個體的用戶端，視內容和其他用戶端正在執行的動作而定的較長的逾時。）短暫逾時可能會導致服務和有相當大的延遲的資源過度重試作業。 封鎖如果佇列大量的要求，正在等待的服務或回應的資源，可能會導致很長的逾時。
- **重新嘗試所造成的暫時性錯誤的作業失敗。** 設計存取所有服務的重試策略，並在其原本不支援自動連線的資源再試一次。 使用包含重試失敗增加，以防止超載的資源，並允許適當地復原並處理佇列的要求的數字之間增加延遲的策略。 使用短暫的延遲連續重試很可能卻會加重問題。
- 遠端服務無法使用時，請**停止傳送邀請，為避免階層式失敗**。 可能的暫時性或其他錯誤嚴重性部分連線中斷的服務，完成故障範圍花更長的時間比預期若要返回 [標準的情況。 此外，如果服務非常忙碌，系統的一組件中的錯誤可能會導致階層式失敗，和導致許多作業變得封鎖按住重要的系統資源，例如記憶體、 執行緒和資料庫連線到。 而非持續重試動作不太成功，應用程式應該快速接受作業失敗，且正常處理此錯誤。 若要拒絕的已定義之特定作業的要求，您可以使用的電路分隔模式。 如需詳細資訊，請參閱[電路分隔圖樣](https://msdn.microsoft.com/library/dn589784.aspx)。
- **撰寫或回到多個元件**以減少離線或無法使用的特定服務的影響。 設計應用程式，以盡可能充分利用多個執行個體，而不影響作業與現有的連線。 使用多個執行個體分散之間，要求和偵測並避免失敗的執行個體，傳送邀請，才能最大化可用性。
- **回到不同的服務或工作流程**可能的位置。 例如，如果寫入到 SQL 資料庫失敗，請暫時將資料儲存在 blob 儲存體。 提供服務有空時，重新執行 SQL 資料庫 blob 儲存體寫入的功能。 在某些情況下，失敗的作業可能的替代的動作，讓應用程式，可以繼續處理甚至元件或服務失敗時。 如果可能的話，偵測失敗，並重新導向到其他服務的可以提供適當的替代功能，或備份的要求或精簡的功能的主要服務離線時可以維護核心作業的執行個體。

## <a name="monitoring-and-disaster-recovery"></a>監控和損毀的復原

- **提供豐富儀器可能失敗和失敗事件的**報告作業人員的情況。 錯誤的可能，但還沒有發生，提供足夠的資料，以啟用作業人員原因、 降低的狀況，並確保系統仍然可以使用。 已經發生的失敗次數，應用程式應該傳回適當的錯誤訊息給使用者，但繼續執行 [帶有精簡功能的 [執行]。 在所有的情況下，監控系統應該擷取完整詳細資料] 來啟用作業人員效果快速修復，若有必要，設計和開發人員修改系統以防止從一次發生這種情況。
- **監控系統運作情況，透過實作檢查函數。** 健康狀況與應用程式的效能可能會降低一段時間，不會醒目的通知，直到它失敗。 實作探查或存回會執行定期從應用程式外的函數。 可以，只要測量回應時間整個應用程式、 個別的組件的應用程式、 個別服務應用程式使用，或個別元件這些檢查項目。 核取函數可以執行程序，以確保他們產生正確的結果、 測量延遲和檢查的顯示狀態，以及從系統擷取的資訊。
- **定期測試所有的容錯移轉和後援系統，**以確保他們提供與正常運作。 變更系統與作業可能會影響錯誤移轉及後援函數，但可能不會偵測影響，直到主系統失敗或變成多載。 測試之前，才能在執行階段即時問題賠償。
- **測試監控系統。** 自動化容錯移轉及後援系統] 和 [系統健康狀況和使用儀表板的效能手動視覺效果，所有而定的監控和儀器運作正常。 如果這些項目失敗，遺漏重要的資訊，或不正確的資料的報表，運算子可能不知道系統是不佳或失敗。
- **追蹤進度的較長時間執行工作流程**和重試失敗。 長時間執行工作流程通常被組成的多個步驟。 確定每一個步驟是獨立和減少整個工作流程需要復原後，可以重試或多個補償交易需要執行。 監視並管理的較長時間執行工作流程進度實作模式，例如[排程器代理程式的主管圖樣](https://msdn.microsoft.com/library/dn589780.aspx)。
- **規劃損毀修復。** 請確定有是從任何類型的失敗，可能會呈現部分或所有主系統復原文件、 已接受，以及完整測試方案無法使用。 定期，測試程序，並確保所有作業人員都熟悉程序。
