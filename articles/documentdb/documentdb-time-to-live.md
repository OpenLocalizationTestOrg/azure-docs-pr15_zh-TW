<properties
   pageTitle="到期 DocumentDB 中的資料與時間至 live |Microsoft Azure"
   description="TTL，請使用 Microsoft Azure DocumentDB 會提供份文件會自動清除從系統在一段時間的功能。"
   services="documentdb"
   documentationCenter=""
   keywords="存留時間"
   authors="kiratp"
   manager="jhubbard"
   editor=""/>

<tags
   ms.service="documentdb"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="04/28/2016"
   ms.author="kipandya"/>

# <a name="expire-data-in-documentdb-collections-automatically-with-time-to-live"></a>到期自動與存留時間 DocumentDB 集合中的資料

應用程式，可以產生並儲存大量資料。 有些資料，例如機器產生的事件資料、 記錄，以及使用者工作階段資訊只有有幫助的一段有限的時間。 一旦資料就是過多的應用程式的需求，則清除此資料，並減少應用程式的儲存空間的需求。

使用 「 存留時間] 或 [TTL]，Microsoft Azure DocumentDB 會提供可讓一段時間後會自動從資料庫清除文件。 可以在集合層級設定預設存留時間，並覆寫每個文件為基礎。 設定 TTL，有預設的集合，或是在文件層級 DocumentDB 會自動移除存在的一段時間 （秒） 後，自上次修改的文件。

上次修改文件時，在 DocumentDB 存留時間會使用針對位移。 若要這麼做，會使用每個文件已存在 _ts 欄位。 [_Ts] 欄位是 unix 樣式期間的時間戳記，表示的日期和時間。 每次修改文件時，就會更新 _ts 欄位。 

## <a name="ttl-behavior"></a>[TTL] 的行為

[TTL] 屬性，在兩種層級-集合層級和文件層級控制 [TTL] 功能。 值會被視為從 _ts 在上次修改文件的差異，並設定秒數。

 1.  DefaultTTL 集合
  * 如果遺失 （或設為 null），文件不會自動刪除。
  
  * 如果簡報及值為 「-1 」 = 無限 – 預設不到期的文件
  
  * 如果簡報及值是部分的數字 ("n")-文件到期"n"秒後上次修改

 2.  [TTL] 的文件︰ 
  * 屬性是僅適用於 DefaultTTL 是上層集合的簡報。
  
  * 覆寫父集合 DefaultTTL 值。

為文件已過期 (ttl + _ts > = 目前的伺服器時間)，文件標示為 「 過期 」。 沒有任何作業會允許這些文件這次後，將會排除執行任何查詢的結果。 文件實際系統中刪除，並視情況在稍後刪除背景中。 不使用任何[要求單位 (RUs)](documentdb-request-units.md)從集合預算。

上述邏輯可以顯示下列矩陣中︰

|       | 集合上的 DefaultTTL 不遺失設定 | DefaultTTL = 集合-1 | DefaultTTL ="n"集合|
| ------------- |:-------------|:-------------|:-------------|
| TTL 遺失文件| 任何動作，因為文件和集合沒有 [TTL] 的概念，在文件層級覆寫。 | 在此集合中的文件即將過期。 | 經過的時間間隔 n 時，便會到期這個集合中的文件。 |
| [TTL] =-1 的文件 | 任何動作，因為集合不定義 DefaultTTL 屬性的文件可以覆寫的文件層級，覆寫。 [TTL] 上的文件是取消解譯系統。 | 在此集合中的文件即將過期。 | 永不過期 TTL = 1 這個集合中的文件。 所有其他的文件便會到期"n"時間間隔。 |
|  [TTL] = n 文件 | 沒有覆寫的文件層級的項目。 [TTL] 上的文件中取消解譯系統。 | 使用 [TTL] 的文件 = n 便會到期後間隔按 n、 秒數。 其他文件會繼承間隔的-1，並永不過期。 | 使用 [TTL] 的文件 = n 便會到期後間隔按 n、 秒數。 其他文件將"n"間隔繼承集合。 |


## <a name="configuring-ttl"></a>設定 [TTL]

根據預設，所有 DocumentDB 集合中，然後在 [所有文件的預設為停用存留時間。

## <a name="enabling-ttl"></a>啟用 [TTL]

若要啟用 [TTL] 的集合，或集合中的文件，必須先將集合 DefaultTTL 屬性設定為-1 或非零的正數。 設定 DefaultTTL-1 所代表的意義，依預設會永遠 live 集合中的所有文件，但 DocumentDB 服務應該監視此集合覆寫此預設的文件。

## <a name="configuring-default-ttl-on-a-collection"></a>設定預設 TTL 集合上

您就可以設定預設集合層級存留時間。 

若要設定 [TTL] 的集合，您需要提供的非零正數表示以秒數，到期的文件 (_ts) 之後的上次修改時間戳記集合中的所有文件的時間。

或者，您可以設定預設為-1，這表示所有文件中插入的集合依預設會永遠 live。

## <a name="setting-ttl-on-a-document"></a>設定 [TTL] 上的文件

除了設定預設 TTL 集合中，您可以設定特定的 TTL 文件層級。 執行此動作會覆寫預設的集合。

若要設定 [TTL] 上的文件，您需要提供的非零正數表示期間的秒數 (_ts) 的文件上次修改時間戳記後過期文件。

若要設定這個到期位移，設定文件中的 [TTL] 欄位。

如果文件沒有 [TTL] 欄位，會套用預設的集合。

如果 [TTL] 已停用集合層級，再次集合上啟用 TTL 之前，也會忽略文件中的 [TTL] 欄位。


## <a name="extending-ttl-on-an-existing-document"></a>延伸 TTL 上現有的文件

您可以進行書寫作業文件，以重設 [TTL] 上的文件。 執行此動作會為目前的時間，設定 _ts，倒數文件到期，所設定的 ttl，請將開始一次。

如果您想要變更 [ttl] 的文件，您可以更新功能變數，您可以使用任何其他可設定欄位做為。


## <a name="removing-ttl-from-a-document"></a>[TTL] 移除文件

如果已設定 [TTL] 上的文件，您不想再到期的文件，然後您可以擷取文件，移除 [TTL] 的欄位及取代伺服器上的文件。

當文件中移除 [TTL] 欄位時，將會套用集合的預設值。

若要停止從過期的文件，並不會從集合繼承然後必須設定 [TTL] 值為-1。


## <a name="disabling-ttl"></a>停用 [TTL]

若要停用 [TTL] 集合上完全並停止尋找集合的 DefaultTTL 屬性應該刪除到期的文件的背景程序。

刪除此屬性與不同將它設定為-1。 -1 表示集合中加入的新文件的設定將會永久 live，但您可以覆寫特定的文件集合中。

集合中完全移除此屬性表示，便會到期的文件，即使有明確覆寫先前的預設值的文件。


## <a name="faq"></a>常見問題集

**將 [TTL] 的價格為何我？**

有任何其他成本] 以設定 [TTL] 上的文件。

**將會多久設定 TTL 後，請刪除我的文件？**

為文件已過期，文件會標示為無法使用 (ttl + _ts > = 目前的伺服器時間)。 沒有任何作業會允許這些文件這次後，將會排除執行任何查詢的結果。 在背景中系統實際會刪除文件。 這不會使用任何 RUs 從集合的預算。

**如果需要一段時間，若要刪除文件，將它們會計入我配額 （和帳單），直到其刪除嗎？**

否，一旦文件已過期不儲存空間的這些文件的計費，文件的大小會不會計入集合的儲存配額。

**[TTL] 上的文件對會造成任何影響 RU 費用嗎？**

否，將會不會影響 RU 費用 DocumentDB 內任何文件上執行的作業。

**將會刪除對我有佈建我集合的處理量的文件影響？**

否，處理您的集合針對要求將優先順序透過接收執行刪除您的文件的背景程序。 將 [TTL] 新增至任何文件不會影響此。

**當文件到期時，多久會將其保留在我集合遭到刪除前？**

文件到期時，就不會出現可存取。 精確的時間文件會保留在您的集合之前實際刪除沒有一定會依據背景處理程序時無法刪除文件。

**在所有節點，會刪除到期的文件，或它是 「 最後 consistent? 」**

文件會變成無法同時在所有節點，並在所有區域中。

**有 TTL 監控背景的工作 RU 成本嗎？**

否，也有這沒有 RU 成本。

**[TTL] 的到期日的檢查頻率？**

檢查 [TTL] 的到期日，不會為背景的程序。 回應邀請時的後端服務會執行內嵌的檢查，並排除任何已到期的文件。 實際的文件刪除是只非同步背景中執行的程序。 使用 RUs 集合上取決於此程序的頻率。

**[TTL] 功能僅適用於整個文件，或可以會過期的個別文件的屬性值？**

[TTL] 適用於整份文件。 如果您想要過期只是文件的部分，然後建議從主文件中的部分擷取至另一個 「 連結 」 的文件，然後使用該解壓縮後的文件上的 [TTL]。

**[TTL] 功能是否有任何特定編製索引的需求？**

[是]。 [編製索引作業原則設定](documentdb-indexing-policies.md)Lazy] 或 [一致時，必須集合。 嘗試使用索引編製功能設定為無集合上設定 DefaultTTL 會導致錯誤，以及嘗試關閉編製索引作業已設定 DefaultTTL 集合上。


## <a name="next-steps"></a>後續步驟

若要進一步瞭解 Azure DocumentDB，請參閱服務[*文件*](https://azure.microsoft.com/documentation/services/documentdb/)頁面。




