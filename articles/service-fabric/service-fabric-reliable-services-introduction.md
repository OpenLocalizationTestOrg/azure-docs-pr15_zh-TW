<properties
   pageTitle="服務布料的轉印圖樣可靠服務程式設計模型概觀 |Microsoft Azure"
   description="深入瞭解服務的結構可靠的服務程式設計模型，並開始撰寫您自己的服務。"
   services="Service-Fabric"
   documentationCenter=".net"
   authors="masnider"
   manager="timlt"
   editor="vturecek; mani-ramaswamy"/>

<tags
   ms.service="Service-Fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="03/25/2016"
   ms.author="masnider;vturecek"/>

# <a name="reliable-services-overview"></a>可靠 Services 概觀
Azure 服務布料的轉印圖樣簡化撰寫及管理狀態和狀態可靠的服務。 這份文件會討論︰

- 無狀態和狀態服務可靠的服務程式設計模型。
- 您必須進行撰寫可靠的服務時的選項。
- 某些情況和範例使用可靠的服務和寫入的方式。

可靠的服務是一種程式設計的模型提供服務布料的轉印圖樣。 如需有關可靠的動作項目程式設計模型的詳細資訊，請參閱[簡介服務布料的轉印圖樣可靠的動作項目](service-fabric-reliable-actors-introduction.md)。

在服務結構服務設定] 應用程式碼，組成，而 （選擇性） 狀態。

服務布料的轉印圖樣佈建與透過升級和刪除，透過[服務布料的轉印圖樣應用程式管理](service-fabric-deploy-remove-applications.md)部署管理服務的存留時間。

## <a name="what-are-reliable-services"></a>什麼是可靠的服務？
可靠的服務可讓您的簡單、 強大的頂層程式設計模型，以協助您快速重要事項您的應用程式。 使用可靠的服務程式設計模型，您可以實現︰

- 如需狀態服務，可靠的服務程式設計模型可讓您一致且確實會儲存在您的服務狀態權利使用可靠的集合。 這是一組簡單的高度可用的集合類別，應該不陌生，已使用 C# 集合的任何人。 一般而言，服務需要可靠的狀態管理外部系統。 使用可靠的集合，您可以旁您計算儲存您的狀態，具有相同的可用性和可靠性發生的事了從高度可用的外部存放區，以及共同尋找計算和狀態提供的其他延遲改良項目。

- 執行您的程式碼的簡單的模型看起來像程式設計您習慣的模型。 您的程式碼具備明確定義的項目點及容易管理生命週期。

- 隨插即用通訊模型。 使用您的選擇，例如 HTTP [Web API](service-fabric-reliable-services-communication-webapi.md)、 WebSockets、 自訂的 TCP 通訊協定等與傳輸。可靠的服務提供一些很棒的方塊出可以使用的選項，或提供您自己。

## <a name="what-makes-reliable-services-different"></a>為何可靠的服務不同？
服務布料的轉印圖樣可靠的服務與您之前所撰寫的服務不同。 服務布料的轉印圖樣提供可靠性、 可用性、 一致性，以及擴充。  

- **可靠性**-您的服務會保留設定，即使是在您的電腦可能會失敗或按下網路問題所在的不穩定環境。

- **顯示狀態**，您的服務會連線到和回應。 (這表示您無法使用服務的找不到或從連線到外部。)

- **延展性**-服務會與特定的硬體分離，他們可以放大或縮小視透過新增或移除的硬體或虛擬資源。 確保服務的獨立部分可以不按比例縮放，獨立地回應失敗容易服務分割 （特別是在有狀態的大小寫）。 最後，服務布料的轉印圖樣鼓勵要盡可能讓數以千計的單一的程序中, 提供的服務，而不是需要或單一特定工作負載的執行個體專用整個 OS 執行個體的服務。

- 可以保證**一致性**-儲存此服務中的任何資訊會一致 （此適用於僅至服務狀態-更多在此更新版本）

## <a name="service-lifecycle"></a>服務生命週期
無論您的服務是狀態或無狀態，可靠的服務會提供簡單的生命週期，可讓您快速插入程式碼，並開始使用。  有您需要取得您的服務，並執行實作的只要一或兩個方法。

- **CreateServiceReplicaListeners/CreateServiceInstanceListeners** -這是服務定義要使用的通訊堆疊的位置。 通訊堆疊，例如[網頁 API](service-fabric-reliable-services-communication-webapi.md)，是什麼定義接聽端點或服務 （如何用戶端會到達） 的結束點。 也會定義如何顯示結束設定與其他服務碼互動的訊息。

- **RunAsync** -這是您的服務執行商務邏輯的位置。 所提供的取消 token 是針對該工作時應停止。 例如，如果您需要經常拉出可靠的佇列中的郵件，並加以處理的服務，這是的會發生。

### <a name="service-startup"></a>啟動服務

可靠服務的生命週期中的主要事件為︰

1. 公式的結構服務物件 （衍生自的無狀態服務或狀態服務的項目）。

2. `CreateServiceReplicaListeners` / `CreateServiceInstanceListeners`呼叫方法，讓服務傳回其所選擇的一或多個通訊接聽有機會。
  - 請注意，此為選用步驟，雖然大部分服務會直接公開一些端點。

3. 通訊接聽建立之後，會將其開啟。
  - 通訊接聽有一部分的方法`OpenAsync()`，也稱為此時會傳回聆聽服務的位址。 如果您可靠的服務使用其中一個內建 ICommunicationListeners，這是為您進行處理。

4. 一旦通訊接聽已開啟，`RunAsync()`稱為主要服務上的方法。
  - 請注意，`RunAsync()`為選用步驟。 如果服務所有工作直接回應使用者在 [通話] 只，都就不需要用來實作`RunAsync()`。

### <a name="service-shutdown"></a>服務關閉

通話順序時 （若要刪除，升級，或移動） 正在關閉服務會產生鏡像︰ 首先，請取消權杖由`RunAsync()`已取消。然後`CloseAsync()`稱為通訊接聽程式。

有幾個重要事項關閉狀態服務的相關附註︰

- 服務布料的轉印圖樣會升級至主要的狀態，直到您服務的另一個複本`CloseAsync`和`RunAsync`回來。 如果您使用內建的通訊接聽程式，`CloseAsync`您處理方法。

- 時上從這些方法傳回沒有時間限制，您會立即遺失可寫入可靠的集合，，因此無法完成任何實數的工作。 建議您當初為在收到取消邀請的最快的方式。

## <a name="example-services"></a>範例服務
了解這個程式設計模型，讓我們來看看兩個不同的服務，若要查看這些部份搭配。

### <a name="stateless-reliable-services"></a>無可靠的服務
無服務是一個位置如實沒有內服務，來維護的狀態，或目前的狀態完全處置，而不需要同步處理、 複製、 持續性或可用性。

例如，請考慮在計算機沒有記憶體，會收到所有的字詞，若要一次執行的作業。

在此情況下，服務的 RunAsync() 可以是空的由於沒有背景工作處理所要執行服務。 建立計算機服務時，它會傳回開啟在某個連接埠接聽端點 ICommunicationListener (例如[Web API](service-fabric-reliable-services-communication-webapi.md))。 此接聽端點會連接至不同的方法 (範例: 「 新增 （n1、 n2） 」) 的定義計算機的公用 API。

從用戶端進行通話時，叫用適當的方法，並計算機服務上執行作業所提供的資料，並傳回結果。 它不會儲存任何狀態。

不儲存任何內部的狀態，可讓此範例計算機非常簡單。 但大部分服務不真的沒有狀態。 不過，他們 externalize 其他存放區其狀態。 （例如，任何 web 應用程式所使用的保留在支援存放區 」 或 「 快取中的工作階段狀態不完全沒有狀態）。

常見範例無狀態服務使用情況的服務布料的轉印圖樣做為前端公開-在公開 API web 應用程式。 若要完成使用者要求的狀態服務然後說話前端服務。 在此情況下，從用戶端的電話傳送給已知連接埠 80，例如沒有狀態服務接聽的位置。 此狀態服務接收通話，並決定是否來自可靠的來源，以哪一種服務以及其預定的通話。  然後，無狀態服務轉寄到正確的磁碟分割狀態服務的通話，並等待回應。 當沒有狀態服務收到回應時，其回覆回到原始的用戶端。

### <a name="stateful-reliable-services"></a>設定狀態可靠的服務
設定狀態服務是必須省/市函數保持一致和服務的順序中的某些部分。 請考慮持續計算根據收到的更新一些值循環平均的服務。 若要這麼做，它必須有目前設定的程序，為目前的平均值，需要輸入要求。 擷取、 程序，並將資訊儲存在外部存放區 （例如 Azure blob 或表格儲存今天） 的任何服務是狀態。 只會外部狀態存放區中保留其狀態。

大部分的服務今天其狀態儲存在外部，由於外部市集所提供的可靠性、 可用性、 延展性及一致性的狀態。 在服務布料的轉印圖樣，狀態服務不儲存所需外部; 其狀態服務布料的轉印圖樣會處理這些需求服務代碼] 及 [服務狀態。

例如，假設我們想要寫會接受要求，不需要執行圖像，以及需要轉換的圖像的轉換的一系列的服務。  這項服務，它會傳回通訊接聽 （假設 Web API），開啟通訊的連接埠並允許透過 API 送出 」 等`ConvertImage(Image i, IList<Conversion> conversions)`。 在此 API，服務無法擷取資訊，在可靠的佇列中，儲存要求，然後返回一些權杖用戶端，讓它可以保留追蹤要求 （因為要求可能需要一些時間）。

在這項服務，RunAsync 可能會更複雜的。 服務可能會有迴圈中拉出 IReliableQueue 要求、 執行轉換，列出，並將結果儲存在 IReliableDictionary，其 RunAsync 時用戶端傳回時，他們可以取得其已轉換的圖像。 即使項目失敗圖像，確定並未遺失，此可靠的服務會拉出佇列中，執行轉換，結果儲存在交易。 在此情況下，訊息實際上只從佇列中移除，轉換完成後，將會儲存在結果字典的結果。 如果項目 （例如電腦執行的程式碼此執行個體） 中間失敗，請要求仍會保留在佇列中等候處理一次。

請注意，這項服務是聽起來標準的.NET 服務。 唯一的差異且的資料結構使用 （IReliableQueue 和 IReliableDictionary） 所提供的服務布料的轉印圖樣，因此所做高度可靠、 可用，而且一致。

## <a name="when-to-use-reliable-services-apis"></a>何時使用可靠的服務 Api
如果下列任一動作描述您的應用程式服務需要，您應該考慮可靠的服務 Api:

- 您需要提供多個單位 （例如訂單] 和 [訂單行項目） 省/市的應用程式的行為。

- 應用程式的狀態可以自然模型可靠的字典和佇列。

- 需要高度可用低延遲存取您的狀態。

- 您的應用程式必須在一或多個可靠的集合控制並行或資料粒度的交易作業。

- 您想要管理通訊或控制分割配置服務。

- 程式碼需要無限制執行緒執行階段環境。

- 您的應用程式必須以動態方式建立，或在執行階段 destroy 可靠的字典或佇列。

- 您必須以程式設計方式控制提供服務結構的備份及還原您的服務狀態 * 的功能。

- 您的應用程式需要維護歷程記錄的狀態 * 其單位。

- 您想要開發，或使用協力廠商開發自訂狀態提供者 *。

> [AZURE.NOTE] * 在 SDK 開放提供的功能。


## <a name="next-steps"></a>後續步驟
+ [可靠的服務快速入門](service-fabric-reliable-services-quick-start.md)
+ [進階用法可靠的服務](service-fabric-reliable-services-advanced-usage.md)
+ [可靠的動作項目程式設計模型](service-fabric-reliable-actors-introduction.md)
